"use strict";angular.module("koodainApp",["ngCookies","ngResource","ngSanitize","ngFileUpload","ngVis","ui.router","ui.bootstrap","ui-notification","ui.ace","rt.encodeuri","nya.bootstrap.select","ui.grid","ui.grid.selection","ui.grid.resizeColumns","angular.filter","ngMaterial","smart-table"]).constant("deviceManagerUrl","http://130.230.142.101:3001").config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","NotificationProvider",function(a,b,c,d,e){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor"),e.setOptions({startTop:55})}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(c){d.authenticate&&!c&&(a.preventDefault(),b.path("/login"))})})}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("koodainApp").controller("LoginCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){a.errors.other=b.message})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("koodainApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("koodainApp").controller("SignupCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("koodainApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("koodainApp").controller("ApiDescrCtrl",["$scope","$http","deviceManagerUrl",function(a,b,c){function d(a,d){var e={swagger:"2.0",info:{version:"1.0.0",title:a,description:a+" API"},consumes:["application/json"],produces:["application/json"],paths:{"/items":{get:{description:"Returns all items",responses:{200:{description:"A list of items.",schema:{type:"array",items:{$ref:"#/definitions/Item"}}}}}}},definitions:{Item:{type:"object",required:["id","name"],properties:{id:{type:"integer",format:"int64"},name:{type:"string"}}}},"x-device-capability":d};return b({method:"PUT",url:c+"/apis/"+a,data:e})}function e(){b({method:"GET",url:c+"/devicecapabilities"}).then(function(b){a.devCaps=b.data})}function f(){b({method:"GET",url:c+"/apis"}).then(function(b){a.apis=b.data,$timeout(function(){$.fn.matchHeight._applyDataApi()},100)})}a.deviceManagerUrl=c,a.selectedDevCap="",e(),f(),a.newApi=function(){console.log(a.selectedDevCap),d(a.newApiClass,a.selectedDevCap).then(function(){f()})},a.deleteApi=function(a){b({method:"DELETE",url:c+"/apis/"+a.name}).then(function(){f()})},angular.element(document).ready(function(){$.fn.matchHeight._applyDataApi()})}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("api-descr",{url:"/api-descr",templateUrl:"app/api-descr/api-descr.html",controller:"ApiDescrCtrl"})}]),angular.module("koodainApp").controller("deploySheetCtrl",["$scope","$mdDialog","$http","stagedDeployments","Notification",function(a,b,c,d,e){a.stagedDeployments=d,a.showResults=!1,a.deploymentDone=!1;var f=function(){console.log(d),d.forEach(function(a){a.confirmDeployment=!0})};f(),a.cancel=function(){b.cancel()},a.numDeployments=0,a.numSuccessDeps=0,a.numFailDeps=0,a.results=[],a.deploy=function(){var f=[];d.forEach(function(a){a.confirmDeployment&&f.push(a)}),f.length&&(console.log("Deployment process started"),e.info("Deployment process started"),a.showResults=!0,a.results.push("Deployment process started"),c({method:"POST",url:"/api/projects/deploy",data:{deployments:f}}).then(function(c){console.log("ressssssssssssssssss:");var d=c.data.result.map(function(a){return JSON.parse(a).id});a.devQuery="FOR device IN devices FOR app in device.apps[*] FILTER app.id IN "+JSON.stringify(d)+" RETURN app",a.numSuccessDeps=c.data.numberOfSuccess,a.numFailDeps=c.data.numberOfFailure,e.info("Number of successful deployments: "+c.data.numberOfSuccess),a.results.push("Number of successful deployments: "+c.data.numberOfSuccess),e.info("Number of failed deployments: "+c.data.numberOfFailure),a.results.push("Number of failed deployments: "+c.data.numberOfFailure+"\n Reasons: "+c.data.result.toString()),e.info("Deployment process completed"),a.results.push("Deployment process completed"),a.deploymentDone=!0,a.stagedDeployments=[],b.hide()})["catch"](function(b){console.log(b),e.error("Deployment process encountered some problems!"),a.results.push("Deployment process encountered some problems!"),a.deploymentDone=!0,a.stagedDeployments=[]}))}}]),angular.module("koodainApp").controller("updateSheetCtrl",["$scope","$mdDialog","$http","installedApps","Notification",function(a,b,c,d,e){function f(a){return"/api/pipe/"+a}a.installedApps=d,a.showResults=!1,a.modificationsDone=!1;var g=function(){console.log(d),d.forEach(function(a){a.isSelected&&a.isSelected===!0&&(a.confirmModification=!0)})};g(),a.cancel=function(){b.cancel()},a.numModifications=0,a.numSuccessMods=0,a.numFailMods=0,a.results=[],a.updateAllApps=function(){a.installedApps.forEach(function(b){b.isSelected&&b.isSelected===!0&&b.confirmModification===!0&&a.updateApp(b.device,b)}),b.hide()},a.updateApp=function(a,b){return console.log(b.name),c({method:"PUT",url:"/api/projects/"+b.name.slice(10)+"/package",data:{deviceUrl:a.url,appId:b.id}}).then(function(a){e.success("Updating the app "+b.name+" in "+b.device.name+" was successful")})["catch"](function(a){e.error("Connection to the application was not successful.")})},a.rollBackAllApps=function(){a.installedApps.forEach(function(b){b.isSelected&&b.isSelected===!0&&b.confirmModification===!0&&a.rollbackApp(b.device,b)}),b.hide()},a.rollbackApp=function(a,b){var d=a.url+"/app/"+b.id+"/rollback";return c({url:f(d),method:"POST"}).then(function(a){e.success("Rollback of the app "+b.name+" in "+b.device.name+" was successful")},function(a){e.error("Connection to the application was not succeccfull.")})},a.setAllAppsStatus=function(c){a.installedApps.forEach(function(b){b.isSelected&&b.isSelected===!0&&b.confirmModification===!0&&a.setAppStatus(b.device,b,c)}),b.hide()},a.setAppStatus=function(a,b,d){var g=a.url+"/app/"+b.id;return c({url:f(g),method:"PUT",data:{status:d}}).then(function(a){e.success(d+" the app "+b.name+" in "+b.device.name+" was successful")},function(a){"installed"!==b.status&&e.error("Starting the application was not succeccfull.")})},a.removeAllApps=function(){a.installedApps.forEach(function(b){b.isSelected&&b.isSelected===!0&&b.confirmModification===!0&&a.removeApp(b.device,b)}),b.hide()},a.removeApp=function(a,b){var d=a.url+"/app/"+b.id;return c({url:f(d),method:"DELETE"}).then(function(a){e.success("Removing app "+b.name+" in "+b.device.name+" was successful")})["catch"](function(a){e.error("Connection to the application was not succeccfull.")})}}]),angular.module("koodainApp").controller("querySheetCtrl",["$scope","$mdDialog","$http","deviceManagerUrl","DeviceManager",function(a,b,c,d,e){function f(a){var b={app:"app",device:"device",none:"none"};return a.hasOwnProperty("_key")&&a.hasOwnProperty("location")&&a.hasOwnProperty("status")?b.device:a.hasOwnProperty("id")&&a.hasOwnProperty("status")?b.app:b.none}function g(){console.log(a.userQuery);var b=[],c=[],d=a.userQuery;if(d){console.log(d);var e="none";h.queryDevicess(d).then(function(d){if(a.queryResult=JSON.stringify(d,null,2),d.forEach(function(a){e=f(a),"app"==e?(console.log(e),b.push(a)):"device"==e&&(console.log(e),c.push(a),a.apps&&a.apps.forEach(function(a){b.push(a)}))}),"app"==e){var g=JSON.stringify(b.map(function(a){return a.id}));console.log(g);var i="LET devs = (FOR device IN devices\nFOR app in device.apps[*]\nFILTER app.id IN "+g+" RETURN DISTINCT device)\nFOR dev in devs\nLET apps = (FOR app in dev.apps[*] FILTER app.id IN "+g+' RETURN app)\nRETURN MERGE_RECURSIVE(UNSET(dev,"apps"), {apps: apps})';return h.queryDevicess(i).then(function(a){return a.forEach(function(b){console.log(a),c.push(b)}),{queriedDevs:c,queriedApps:b}})}return{queriedDevs:c,queriedApps:b}}).then(function(b){console.log(b),a.queryResultData=b})["catch"](function(b){console.log(b),a.queryResult=b.data.message})}}a.userQuery="",a.queryResult="",a.queryResultData;var h=e(d);a.executeQuery=function(){g()},a.applyQueryResult=function(){b.hide(a.queryResultData)},a.cancel=function(){b.cancel()}}]),angular.module("koodainApp").controller("AppLogCtrl",["$scope","$http","$uibModalInstance","Notification","device","app",function(a,b,c,d,e,f){function g(a){return"/api/pipe/"+a}a.device=e,a.app=f,a.cancel=function(){c.dismiss("cancel")},f._logInterval=setInterval(function(){var c=e.url+"/app/"+f.id+"/log";b({method:"GET",url:g(c)}).then(function(b){a.log=b.data.message},function(b){a.cancel(),d.error("Connection to the application was not successful.")})},2e3)}]),angular.module("koodainApp").controller("DeployCtrl",["$scope","$http","$resource","$uibModal","Notification","DeviceManager","deviceManagerUrl","$q","uiGridConstants","$mdDialog","$stateParams","$timeout","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){return b({method:"GET",url:"/api/projects/"+a.name+"/files/liquidiot.json"}).then(function(b){var c=JSON.parse(b.data.content),d=c.deviceCapabilities,e=d.indexOf("free-class");return-1!=e&&d.splice(e,1),a.reqCapabilities=d,a.appInterfaces=c.applicationInterfaces,console.log("GOt capabs",a.name),!0})["catch"](function(a){return a})}function o(a){return b({method:"GET",url:"/api/projects/"+a.name+"/files/package.json"}).then(function(b){var c=JSON.parse(b.data.content);return a.version=c.version,a.description=c.description,console.log("GOt versions",a.name),!0})["catch"](function(a){return a})}function p(){Promise.all(a.projects.map(n)).then(t),Promise.all(a.projects.map(o))}var q=c("/api/projects/:project"),r=f(g);a.devList,a.projects,a.capsAndDevsMap=new Map,a.devicesSelected=[],a.capsAndAppsMap=new Map,a.projectsSelected=[],a.stagedDeployments=[],a.gridOptions={enableFiltering:!0,enableRowSelection:!0,multiSelect:!0,enableSelectAll:!0,enableFullRowSelection:!0,enableSelectionBatchEvent:!1,showGridFooter:!0,columnDefs:[{field:"name"},{name:"Location",field:"location.tag"},{name:"Capabilities",field:"classes.toString()"},{name:"Installed apps",field:"getAppNames()"}]},a.projGridOptions={enableFiltering:!0,enableRowSelection:!0,multiSelect:!0,enableSelectAll:!0,enableFullRowSelection:!0,columnDefs:[{name:"name",field:"name"},{name:"Version",field:"version"},{name:"Req.Capabilities",field:"reqCapabilities.toString()"},{field:"appInterfaces.toString()"}]},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.selection.on.rowSelectionChanged(a,function(b){console.log("Row selection changed"+b.isSelected),b.isSelected?(a.devicesSelected.push(b.entity),b.entity.classes.forEach(function(c){if(a.capsAndDevsMap.has(c)){var d=a.capsAndDevsMap.get(c);d.push(b.entity._id),a.capsAndDevsMap.set(c,d)}else{var d=[];d.push(b.entity._id),a.capsAndDevsMap.set(c,d)}})):(a.devicesSelected.splice(a.devicesSelected.indexOf(b.entity),1),b.entity.classes.forEach(function(c){if(a.capsAndDevsMap.has(c)){var d=a.capsAndDevsMap.get(c),e=d.indexOf(b.entity._id);d.splice(e,1),0==d.length?a.capsAndDevsMap["delete"](c):a.capsAndDevsMap.set(c,d)}}));var c=[];a.projects.forEach(function(b){(0==b.reqCapabilities.length||s(Array.from(a.capsAndDevsMap.keys()),b.reqCapabilities))&&c.push(b)}),a.projGridOptions.data=c}),b.selection.on.rowSelectionChangedBatch(a,function(a){console.log("Row selection changed"+a.length)})},a.projGridOptions.onRegisterApi=function(b){console.log("Progj grid onregisterApi called"),a.projGridApi=b,b.selection.on.rowSelectionChanged(a,function(b){if(console.log("Row selection changed"+b.isSelected),console.log(b.entity),b.isSelected?(a.projectsSelected.push(b.entity),b.entity.reqCapabilities.forEach(function(c){if(a.capsAndAppsMap.has(c)){var d=a.capsAndAppsMap.get(c);d.push(b.entity.name),a.capsAndAppsMap.set(c,d)}else{var d=[];d.push(b.entity.name),a.capsAndAppsMap.set(c,d)}})):(a.projectsSelected.splice(a.projectsSelected.indexOf(b.entity),1),b.entity.reqCapabilities.forEach(function(c){if(a.capsAndAppsMap.has(c)){var d=a.capsAndAppsMap.get(c),e=d.indexOf(b.entity.name);d.splice(e,1),0==d.length?a.capsAndAppsMap["delete"](c):a.capsAndAppsMap.set(c,d)}})),Array.from(a.capsAndAppsMap.keys()).length>0){var c=[];a.devList.forEach(function(b){s(Array.from(a.capsAndAppsMap.keys()),b.classes)&&c.push(b)}),a.gridOptions.data=c}else a.gridOptions.data=a.devList}),b.selection.on.rowSelectionChangedBatch(a,function(a){console.log("Row selection changed"+a.length)})},a.loadDevices=function(){return r.queryDevicess().then(function(b){console.log(b),a.devList=b,a.devList.forEach(function(a){a.getAppNames=function(){var a=[];return this.apps&&this.apps.forEach(function(b){a.push(b.name.replace("liquidiot-",""))}),a.toString()}}),a.gridOptions.data=b}).then(function(a){return"done"})},a.loadDevices(),q.query(function(b){a.projects=b,a.projGridOptions.data=a.projects,p()});var s=function(a,b){return a.every(function(a){return b.indexOf(a)>=0})},t=function(){if(console.log("running handleProjectParam"),k.project){var b,c;for(c=0;c<a.projects.length;c++)if(a.projects[c].name==k.project){b=a.projects[c];break}b&&a.projGridApi.selection.selectRow(b)}};a.stageDeploy=function(){console.log(a.projectsSelected),console.log(a.devicesSelected);var b=[],c=[];a.devicesSelected.forEach(function(a){b.push(a.name+" in "+a.location.tag),c.push({url:a.url})}),a.projectsSelected.forEach(function(d){var e={projectName:d.name,selectedDevices:c,strTargets:b.toString()};a.stagedDeployments.push(e)}),j.show({controller:"deploySheetCtrl",templateUrl:"deploysheet.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a.customFullscreen,resolve:{stagedDeployments:function(){return a.stagedDeployments}}}).then(function(){a.stagedDeployments=[],a.status="You deployed staged apps"},function(){a.status="You cancelled the dialog."}),a.gridApi.selection.clearSelectedRows(),a.projGridApi.selection.clearSelectedRows(),a.capsAndDevsMap.clear(),a.capsAndAppsMap.clear(),a.projectsSelected=[],a.devicesSelected=[],a.gridOptions.data=a.devList,a.projGridOptions.data=a.projects},a.clearSelection=function(){a.gridApi.selection.clearSelectedRows(),a.projGridApi.selection.clearSelectedRows(),a.gridOptions.data=a.devList,a.projGridOptions.data=a.projects},a.openMapView=function(){a.selectedDeviceIds=[],a.devicesSelected.forEach(function(b){a.selectedDeviceIds.push(b._key)});var b=m.$new();b.selectedDevIds=a.selectedDeviceIds,b.selectedAppIds=[],d.open({templateUrl:"mapSheet.html",controller:"MapViewCtrl",size:"lg",scope:b}).result.then(function(a){console.log(a)})}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("deploy",{url:"/deploy?project",templateUrl:"app/deploy/deploy.html",controller:"DeployCtrl"})}]),angular.module("koodainApp").controller("MapViewCtrl",["$scope","$http","$resource","$uibModal","Notification","VisDataSet","DeviceManager","deviceManagerUrl","$stateParams","$q",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){return b?"app:"+a.status+":selected":"app:"+a.status}function l(a,b){return b?"device:"+a.status+":selected":"device:"+a.status}function m(a){var b=a.id,c={id:b,label:a.name||b,title:G(a),x:a.location.x,y:a.location.y,group:l(a)};return c}function n(a){var b={id:"app:"+a.id,label:a.name,group:k(a),title:H(a)};return b}function o(a){for(var b={},c=0;c<a.length;c++){a[c].id=a[c]._key;var d=a[c];b[d.id]=d}return b}function p(b,c,d,e){C.update(K.map(function(a){return{id:a,group:l(I[a])}})),C.update(b.map(function(a){return{id:a,group:l(I[a],!0)}})),C.update(M.map(function(a){return{id:"app:"+a.id,group:k(a)}})),C.update(e.map(function(a){return{id:"app:"+a.id,group:k(a,!0)}})),K=b,L=e,a.selectedDevices=d,a.camera.fit(),a.camera.checkCrawling()}function q(a){var b={app:"app",device:"device",none:"none"};return a.hasOwnProperty("_key")&&a.hasOwnProperty("location")&&a.hasOwnProperty("status")?b.device:a.hasOwnProperty("id")&&a.hasOwnProperty("status")?b.app:b.none}function r(){console.log("updateSelection");var b=[],c=[],d=[],e=[],f=[],g=a.devQuery;if(g){console.log("entered"),console.log(g);var h="none";E.queryDevicess(g).then(function(a){if(a.forEach(function(a){h=q(a),"app"==h?(console.log(h),b.push(a),c.push("app:"+a.id)):"device"==h&&(console.log(h),d.push(a._key),e.push(a),a.apps&&a.apps.forEach(function(a){b.push(a),c.push("app:"+a.id)}))}),"app"==h){var f=JSON.stringify(b.map(function(a){return a.id}));console.log(f);var g="LET devs = (FOR device IN devices\nFOR app in device.apps[*]\nFILTER app.id IN "+f+" RETURN DISTINCT device)\nFOR dev in devs\nLET apps = (FOR app in dev.apps[*] FILTER app.id IN "+f+' RETURN app)\nRETURN MERGE_RECURSIVE(UNSET(dev,"apps"), {apps: apps})';return E.queryDevicess(g).then(function(a){return a.forEach(function(b){console.log(a),d.push(b._key),e.push(b)}),{queriedDevIds:d,queriedAppIds:c,queriedDevs:e,queriedApps:b}})}return{queriedDevIds:d,queriedAppIds:c,queriedDevs:e,queriedApps:b}}).then(function(a){console.log(a),f=a.queriedDevIds.concat(a.queriedAppIds),x(a.queriedDevs),N.selectNodes(f),p(a.queriedDevIds,a.queriedAppIds,a.queriedDevs,a.queriedApps)})["catch"](function(a){x(d),N.selectNodes(f),p(d,c,e,b)})}else x(d),N.selectNodes(f),p(d,c,e,b)}function s(b){a.loadDevices(),Q&&clearInterval(Q),Q=setInterval(function(){a.loadDevices()},b)}function t(){var b=[],c=[],d=Object.keys(I).map(function(a){return m(I[a])});for(var e in I){var g=I[e],h=g.apps;h&&h.length>0&&(d.push.apply(d,h.map(n)),b.push.apply(b,h),c.push.apply(c,h.map(function(a){return{from:"app:"+a.id,to:g.id,length:50}})))}C=new f(d),D=new f(c),a.graphData={nodes:C,edges:D},M=b}function u(a){return a&&"app:"===a.slice(0,4)}function v(a){return!u(a)}function w(b){var c=b.nodes.filter(v),d=b.nodes.filter(u);a.deselectProject();var e=JSON.stringify(c),f=JSON.stringify(d.map(function(a){return parseInt(a.slice(4,a.length))}));a.devQuery="let devs1 = (for device in devices\nfor app in device.apps[*]\nfilter app.id in "+f+" \nreturn distinct device)\nlet devs2 = (for dev in devs1\nlet apps = (\nfor app in dev.apps[*]\nfilter app.id in "+f+' \nreturn app)\nreturn merge_recursive(unset(dev, "apps"),{apps: apps})) \nlet dev2Ids = (for dev in devs2 return dev._key)\nlet devs3 = (for device in devices filter device._key in '+e+' and device._key not in dev2Ids\nreturn merge(unset(device,"apps"),{apps: []}))\nfor dev in APPEND(devs2, devs3) return dev\n',a.$apply()}function x(a){console.log(a),R=a.map(function(a){return a.classes}),console.log(R)}function y(c,d,e){var f=c.url,g=d.id;return b({method:"PUT",url:"/api/projects/"+e.project+"/package",data:{deviceUrl:f,appId:g}}).then(function(b){return a.numSuccessUps++,b})["catch"](function(b){return a.numFailUps++,b})}function z(a,b){return Promise.all(a.apps.map(function(c){return y(a,c,b)}))}function A(a){return Promise.all(a.selectedDevices.map(function(b){return z(b,a)}))}var B=c("/api/projects/:project");B.query(function(b){a.projects=b}),a.deviceManagerUrl=h;var C,D,E=g(h),F={"device:active":{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"green"},fixed:!0},"device:passive":{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"red"},fixed:!0},"device:active:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:75,color:"green"},fixed:!0},"device:passive:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:75,color:"red"},fixed:!0},"app:installed":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"blue"}},"app:installed:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"blue"}},"app:running":{shape:"icon",icon:{face:"FontAwesome",code:"",size:40,color:"green"}},"app:running:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"green"}},"app:crashed":{shape:"icon",icon:{face:"FontAwesome",code:"",size:40,color:"red"}},"app:crashed:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"red"}},"app:paused":{shape:"icon",icon:{face:"FontAwesome",code:"",size:40,color:"green"}},"app:paused:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"green"}}},G=function(a){var b="<div class='panel panel-success' style='margin-bottom:0px'><div class='panel-heading'><h3 class='panel-title'>device</h3></div><div class='panel-body' style='padding-top: 0px; padding-bottom: 0px'><table class='table' style='border: none; margin-bottom:1px'><!-- tr><td>id</td><td>"+a.id+"</td></tr><tr --><td>name</td><td>"+a.name+"</td></tr><!-- tr><td>capabilities</td><td>"+a.classes.join(", ")+"</td></tr><tr><td>location</td><td>"+a.location+"</td></tr --><tr><td>url</td><td>"+a.url+"</td></tr><!-- tr><td>coordinates</td><td>"+a.location.latitude+","+a.location.longitude+"</td></tr><tr><td>postal address</td><td>"+a.location.streetAddress+","+a.location.addressLocality+"</td></tr><tr><td>location tag</td><td>"+a.location.tag+"</td></tr --><!-- tr><td>coordination</td><td>"+a.location.x+","+a.location.y+"</td></tr --></table></div></div>";return b},H=function(a){var b=a.hasOwnProperty("applicationInterfaces")?a.applicationInterfaces.join(", "):"",c=a.hasOwnProperty("status")?a.status:"",d=a.hasOwnProperty("version")?a.version:"",e=a.hasOwnProperty("description")?a.description:"",f="<div class='panel panel-success' style='margin-bottom:0px'><div class='panel-heading'><h3 class='panel-title'>application</h3></div><div class='panel-body' style='padding-top: 0px; padding-bottom: 0px'><table class='table' style='border: none; margin-bottom:1px'><tr><td>id</td><td>"+a.id+"</td></tr><tr><td>name</td><td>"+a.name+"</td></tr><tr><td>interfaces</td><td>"+b+"</td></tr><tr><td>status</td><td>"+c+"</td></tr><tr><td>version</td><td>"+d+"</td></tr><tr><td>description</td><td>"+e+"</td></tr></table></div></div>";return f},I=[],J=-1;a.camera={fit:function(){N.fit()},fitOnSelectedNodes:function(){1==K.length?N.focus(K[0],{scale:1}):N.fit({nodes:K})},checkCrawling:function(){K.length>1?(J=0,a.isCrawlingPossible=!0):(J=-1,a.isCrawlingPossible=!1)},crawl:function(){J>=0&&J<=K.length&&(J==K.length&&e.info({message:"Crawling started again!",delay:1e3}),J%=K.length,N.focus(K[J],{scale:1}),J++)}};var K=[],L=[],M=[];a.query="",a.$watch("query",function(b,c){a.devQuery=a.query,E.queryDevicess(a.query).then(function(b){console.log(a.query),a.resultQuery=a.query?JSON.stringify(b,null,2):""})["catch"](function(b){a.resultQuery=JSON.stringify(b,null,2)})});var N;a.$watch("devQuery",function(a,b){N&&r()});var O=new Image;O.src="/images/Department.png";var P=!0;a.graphEvents={onload:function(b){N=b,r(),P&&(a.showSelectionsInMap(),P=!1)},beforeDrawing:function(a){a.save(),a.translate(-500,-140),a.rotate(19*Math.PI/180),a.drawImage(O,150,-400,3222,2291),a.restore()},selectNode:w,deselectNode:w},a.showSelectionsInMap=function(){if(a.selectedDevIds&&a.selectedAppIds){console.log(a.selectedDevIds);var b=a.selectedDevIds.concat(a.selectedAppIds);N.selectNodes(b),p(a.selectedDevIds,a.selectedAppIds,[],[])}},a.devList,a.loadDevices=function(){return E.queryDevicess().then(function(b){console.log(b),a.devList=b;var c=o(b);return console.log(c),c}).then(function(a){return I=a,t(),"done"})};var Q;s(6e4),a.$on("$destroy",function(){Q&&clearInterval(Q)}),a.graphOptions={groups:F,interaction:{multiselect:!0}};var R=[];a.updating=!1,a.update=function(){s(3e3);var b=angular.copy(a.updates);a.updates=[],b.length&&(a.numUps=numUpdates,a.numSuccessUps=0,a.numFailUps=0,numUpdates=0,a.updating=!0,e.info("Update process started"),Promise.all(b.map(A)).then(function(b){console.log(b),e.info("Update process completed"),s(6e4),a.loadDevices()}))},a.deleting=!1,a.removeApps=function(){s(3e3),a.numDels=L.length,a.numSuccessDels=0,a.numFailDels=0,a.deleting=!0,e.info("Delete process started"),console.log(a.selectedDevices);var c=a.selectedDevices.map(function(a){var b=a.apps.map(function(a){return{id:a.id}});return{url:a.url,matchedApps:b}});console.log(c),b({method:"DELETE",url:"/api/projects/delete",data:{devices:c},headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(b){console.log(b),a.numSuccessDels=b.data.numberOfSuccess,a.numFailDels=b.data.numberOfFailure,e.info("Delete process completed"),s(6e4),a.loadDevices()})["catch"](function(b){console.log(b),e.error("Delete process encountered some problems!"),s(6e4),a.loadDevices()})},a.deselectProject=function(){a.selectedProject=null},a.deselectProject(),a.$watch("selectedProject",function(){a.selectDevicesForProject()}),a.selectDevicesForProject=function(){a.selectedProject&&b({method:"GET",url:"/api/projects/"+a.selectedProject.name+"/files/liquidiot.json"}).then(function(b){var c=JSON.parse(b.data.content),d=c.deviceCapabilities,e=d.indexOf("free-class");-1!=e&&d.splice(e,1),d&&d.length?a.devQuery="For device IN devices FILTER device.classes[*] ALL IN "+JSON.stringify(d)+' RETURN MERGE(UNSET(device,"apps"),{apps:[]})':a.devQuery='FOR device IN devices RETURN MERGE(UNSET(device,"apps"),{apps:[]})'})},i.project&&B.get({project:i.project},function(b){a.selectedProject=b,a.selectDevicesForProject()})}]),angular.module("koodainApp").directive("selectAllRows",function(){return{require:"^stTable",template:'<input type="checkbox">',scope:{allDataRows:"=allDataRows",selectedRows:"=selectedRows"},link:function(a,b,c){a.areAllRowsSelected=!1,b.bind("click",function(b){console.log(a.allDataRows),console.log(a.selectedRows),a.$apply(function(){a.allDataRows.forEach(function(b){b.isSelected=a.areAllRowsSelected})})}),a.$watchCollection("selectedRows",function(c){console.log("Inside watch selectedRows: ",a.selectedRows);var d=c.length,e=a.allDataRows.length;d===e&&d>0&&e>0?(b.find("input").prop("checked",!0),a.areAllRowsSelected=!1):(b.find("input").prop("checked",!1),a.areAllRowsSelected=!0)})}}}),angular.module("koodainApp").directive("selectRow",function(){return{require:"^stTable",template:'<input type="checkbox">',scope:{rowData:"=rowData"},link:function(a,b,c,d){b.bind("click",function(b){a.$apply(function(){d.select(a.rowData,"multiple")})}),a.$watch("rowData.isSelected",function(c,d){console.log("Inside rowData selectionchange: ",a.rowData),console.log("Inside rowData selectionchange: ",c,d),c===!0?(b.parent().addClass("st-selected"),b.find("input").prop("checked",!0)):(b.parent().removeClass("st-selected"),b.find("input").prop("checked",!1))})}}}),angular.module("koodainApp").controller("ModifyAppInstCtrl",["$scope","$http","$resource","$uibModal","Notification","DeviceManager","deviceManagerUrl","$q","$mdDialog","$filter",function(a,b,c,d,e,f,g,h,i,j){function k(a){b({method:"GET",url:"/api/projects/"+a.name+"/files/liquidiot.json"}).then(function(b){var c=JSON.parse(b.data.content),d=c.deviceCapabilities,e=d.indexOf("free-class");-1!=e&&d.splice(e,1),a.reqCapabilities=d,a.appInterfaces=c.applicationInterfaces}),b({method:"GET",url:"/api/projects/"+a.name+"/files/package.json"}).then(function(b){var c=JSON.parse(b.data.content);a.version=c.version,a.description=c.description})}function l(a){return"/api/pipe/"+a}var m=c("/api/projects/:project");a.deviceManagerUrl=g;var n=f(g);a.devList,a.displayed=[],a.loadDevices=function(){return n.queryDevicess().then(function(b){console.log(b),a.devList=b,a.getInstalledApps()}).then(function(a){return"done"})},a.loadDevices(),m.query(function(b){a.projects=b,angular.forEach(a.projects,function(a,b,c){k(a)})}),a.installedApps=[],a.installedProjectNames=[],a.installedProjects=[],a.selectedAppInstances=[],a.getInstalledApps=function(){a.installedApps=[],a.installedProjectNames=[],a.installedProjects=[],a.devList.forEach(function(b){b.apps&&b.apps.forEach(function(c){var d={id:c.id,name:c.name,version:c.version,device:b,status:c.status,canRollback:c.canRollback};if(!a.installedProjectNames.includes(c.name)){a.installedProjectNames.push(c.name);var e=a.projects.filter(function(a){return a.name==c.name.replace("liquidiot-","")})[0];a.installedProjects.push(e)}a.installedApps.push(d)})})},a.selectAllApps=function(){0===a.selectedAppInstances.length?a.installedApps.forEach(function(b){a.selectedAppInstances.push(b.name+b.device._id)}):a.selectedAppInstances.length>0&&a.selectedAppInstances.length!=a.installedApps.length?a.installedApps.forEach(function(b){var c=a.selectedAppInstances.indexOf(b.name+b.device._id);-1===c&&a.selectedAppInstances.push(b.name+b.device._id)}):a.selectedAppInstances=[]},a.selectApp=function(b){var c=a.selectedAppInstances.indexOf(b.name+b.device._id);-1===c?a.selectedAppInstances.push(b.name+b.device._id):a.selectedAppInstances.splice(c,1)},a.updateApp=function(c,d){return console.log(d.name),b({method:"PUT",url:"/api/projects/"+d.name.slice(10)+"/package",data:{deviceUrl:c.url,appId:d.id}}).then(function(b){e.success("Updating the app "+d.name+" in "+c.name+" was successful"),a.loadDevices()})["catch"](function(b){e.error("Connection to the application was not successful."),a.loadDevices()})},a.rollbackApp=function(c,d,f){var g=c.url+"/app/"+d.id+"/rollback";return b({url:l(g),method:"POST"}).then(function(b){e.success("Rollback of the app "+d.name+" in "+c.name+" was successful"),a.loadDevices()},function(b){e.error("Connection to the application was not succeccfull."),a.loadDevices()})},a.setAppStatus=function(c,d,f){var g=c.url+"/app/"+d.id;return b({url:l(g),method:"PUT",data:{status:f}}).then(function(a){d.status=f,e.success(f+" the app "+d.name+" in "+d.device.name+" was successful")},function(b){return"installed"!==d.status&&e.error("Starting the application was not succeccfull."),a.loadDevices().then(function(){throw b})})},a.removeApp=function(c,d){var f=c.url+"/app/"+d.id;return b({url:l(f),method:"DELETE"}).then(function(b){e.success("Removing the app "+d.name+" in "+d.device.name+" was successful"),a.loadDevices()})["catch"](function(a){e.error("Connection to the application was not succeccfull.")})},a.modifySelectedApps=function(){i.show({controller:"updateSheetCtrl",templateUrl:"updateSheet.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a.customFullscreen,resolve:{installedApps:function(){return a.installedApps}}}).then(function(){a.installedAppsLoaded=!1,a.loadDevices(),console.log("You modified selected apps")},function(){console.log("You cancelled the dialog.")})},a.openLogModal=function(a,b){d.open({controller:"AppLogCtrl",templateUrl:"applog.html",resolve:{
device:a,app:b}}).result.then(null,function(){clearInterval(b._logInterval)})},a.clearSelections=function(){a.installedApps.forEach(function(a){a.isRowSelected=!1})},a.showQueryWindow=function(){i.show({controller:"querySheetCtrl",templateUrl:"querySheet.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a.customFullscreen}).then(function(b){console.log("Result data: ",b),a.installedAppsLoaded=!1,a.devList=b.queriedDevs,a.getInstalledApps(),console.log("You selected devices/apps using query")},function(){console.log("You cancelled the query dialog.")})}}]),angular.module("koodainApp").controller("HomeCtrl",["$scope","$http","$resource","$uibModal","Notification","VisDataSet","DeviceManager","deviceManagerUrl","$stateParams","$q","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){return"/api/pipe/"+a}var m=c("/api/projects/:project");m.query(function(b){a.projects=b}),a.deviceManagerUrl=h;var n=g(h);a.loadDevices=function(){return n.queryDevicess().then(function(b){a.devices=b,k(function(){$.fn.matchHeight._applyDataApi()},100)})},a.loadDevices(),a.openLogModal=function(a,b){d.open({controller:"AppLogCtrl",templateUrl:"applog.html",resolve:{device:a,app:b}}).result.then(null,function(){clearInterval(b._logInterval)})},a.setAppStatus=function(c,d,f){var g=c.url+"/app/"+d.id;return b({url:l(g),method:"PUT",data:{status:f}}).then(function(b){a.loadDevices()},function(b){e.error("Connection to the application was not succeccfull."),a.loadDevices()})},a.removeApp=function(c,d){var f=c.url+"/app/"+d.id;return b({url:l(f),method:"DELETE"}).then(function(){a.loadDevices().then(function(){a.loadDevices()})},function(a){e.error("Connection to the application was not succeccfull.")})}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("Home",{url:"/",templateUrl:"app/home/home.html",controller:"HomeCtrl"})}]),angular.module("koodainApp").controller("HostsCtrl",["$scope","$http","$uibModal","$interval",function(a,b,c,d){function e(){b({method:"GET",url:"/api/visualdevices"}).then(function(b){console.log(b.data),a.hosts=b.data})}function f(a){e(),g&&clearInterval(g),g=d(function(){e()},a)}var g;f(3e3),a.openNewHostModal=function(){c.open({controller:"NewHostCtrl",templateUrl:"newhost.html"}).result.then(function(a){console.log(a)})},a.$on("$destroy",function(){d.cancel(g)})}]).controller("NewHostCtrl",["$scope","$uibModalInstance","$http",function(a,b,c){a.ok=function(){b.close("salam")},a.cancel=function(){b.dismiss("cancel")},a.createHost=function(){c({method:"POST",url:"/api/visualdevices",data:{hostname:a.host.name}}).then(function(b){a.ok()})["catch"](function(b){a.errorLog=JSON.stringify(b.data,null,4)})}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("hosts",{url:"/hosts",templateUrl:"app/hosts/hosts.html",controller:"HostsCtrl"})}]),angular.module("koodainApp").controller("MainCtrl",["$scope","$http","$resource","$uibModal","Notification",function(a,b,c,d,e){var f=c("/api/projects");a.projects=f.query(),a.openNewProjectModal=function(){d.open({controller:"NewProjectCtrl",templateUrl:"newproject.html"}).result.then(function(a){var b=new f({name:a});return b.$save()}).then(function(){a.projects=f.query()},function(a){e.error(a.data.error)})},a.deleteProjectModal=function(b){d.open({controller:"deleteProjectCtrl",templateUrl:"deleteproject.html",resolve:{project:function(){return b}}}).result.then(function(a){console.log(name);var b=c("/api/projects/"+a);return b.remove()}).then(function(){a.projects=f.query()},function(a){e.error(a.data.error)})}}]).controller("NewProjectCtrl",["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close(a.newproject.name)},a.cancel=function(){b.dismiss("cancel")}}]).controller("deleteProjectCtrl",["$scope","$uibModalInstance","project",function(a,b,c){a.project=c,a.ok=function(){b.close(a.project.name)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("koodainApp").controller("ProjectCtrl",["$scope","$stateParams","$resource","$http","$location","$state","Notification","Upload","project","files","resources","apitocode","deviceManagerUrl","apiParser","$uibModal",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){var b="module.exports = function($app, $router, $request, console){\n",c="\n}";a.content=b+a.content+c}function q(a,b){return h.upload({url:b,data:{file:a}}).then(function(){g.success("Uploaded "+a.name)})}a.project=i,a.files=j,a.resources=k,console.log(a.project),console.log(a.files),console.log(a.resources),a.changeView=function(b){f.go("deploy",{project:a.project.name})},d({method:"GET",url:m+"/devicecapabilities"}).then(function(b){a.devCaps=b.data,a.devCaps.push({name:"free-class",description:"not bound to any device"});var c=a.files.files.filter(function(a){return"liquidiot.json"===a.name});c.length>0&&(a.liquidiotJson=c[0],a.selectedDevCaps=JSON.parse(a.liquidiotJson.content).deviceCapabilities)}),a.$watch("selectedDevCaps",function(){d({method:"GET",url:m+"/apis",params:{devcap:a.selectedDevCaps}}).then(function(b){a.apis=b.data,a.selectedAppCaps=JSON.parse(a.liquidiotJson.content).applicationInterfaces})}),a.showAPIs=function(){o.open({templateUrl:"showapis.html",controller:"showAPIsCtrl",resolve:{implementedAPIs:function(){return a.selectedAppCaps},allAPIs:function(){return a.apis},projectName:function(){return a.project.name}}}).result.then(function(b){a.selectedAppCaps=b,a.generateCode()})},a.generateCode=function(){try{var b=a.mainFile.content,c=n.getApiList(b);console.log(c);var d=JSON.parse(a.liquidiotJson.content);d.applicationInterfaces=a.selectedAppCaps,d.deviceCapabilities=a.selectedDevCaps,a.liquidiotJson.content=JSON.stringify(d),b=n.markAsDirty(c,a.selectedAppCaps,b),a.mainFile.content=b;for(var e=c.filter(function(a){return"working"==a.state}).map(function(a){return a.name}),f=0;f<a.selectedAppCaps.length;f++)-1==e.indexOf(a.selectedAppCaps[f])&&l.generate(a.project,m+"/apis/"+a.selectedAppCaps[f]).then(function(b){a.mainFile.content+=b})}catch(h){g.error("Fix all syntax errors in the code and try again.")}},a.deleteDirtyApis=function(){try{var b=a.mainFile.content,c=n.getApiList(b);a.mainFile.content=n.deleteDirtyApis(c,b)}catch(d){g.error("Fix all syntax errors in the code and try again.")}},a.updating={},a.$watch("mainFile.content",function(){var b=angular.copy(a.mainFile);if(b){p(b);var c=x.update({name:b.name},b);a.updating[b.name]=c.$promise.$$state}}),a.$watch("liquidiotJson.content",function(){var b=a.liquidiotJson;if(b){var c=x.update({name:b.name},b);a.updating[b.name]=c.$promise.$$state}});var r=ace.require("ace/ext/modelist"),s="/api/projects/"+b.project;a.openFile=function(b){a.activeFile=b;var c=r.getModeForPath(b.name);a.activeFile.mode=c?c.name:null};var t=j.files.filter(function(a){return"main.js"===a.name});if(t.length>0){a.openFile(t[0]),a.mainFile=t[0];var u=a.mainFile.content;console.log("c"+u),console.log(u.split("\n"));var v=a.mainFile.content.split("\n");console.log(v),v.splice(v.length-1,1),v.splice(0,1),console.log(v),a.mainFile.content=v.join("\n")}var w;a.aceLoaded=function(a){w=a,w.$blockScrolling=1/0,w.setOptions({fontSize:"11pt"})};var x=c(s+"/files/:name",null,{update:{method:"PUT"}});a.$watch("activeFile.content",function(){var b=a.activeFile;if("package.json"==b.name||"agent.js"==b.name){var c=x.update({name:b.name},b);a.updating[b.name]=c.$promise.$$state}}),a.uploadFile=function(b){var d=s+"/files";q(b,d).then(function(){a.files=c(d).get()})},a.uploadResource=function(b){var d=s+"/files/resources";q(b,d).then(function(){a.resources=c(d).get()})}}]).factory("apitocode",["$q",function(a){var b=function(b,d){return a(function(a,e){SwaggerParser.validate(d).then(function(d){var e="\n/**\n * Application Interface: "+d.info.title+"\n */";for(var f in d.paths)for(var g in d.paths[f])e+=c(b,g,f);a(e+"// "+d.info.title+" - end\n")})})},c=function(a,b,c){return"\n$router."+b+'("'+c+'", function(req, res){});\n'};return{generate:b}}]).factory("apiParser",function(){var a=function(a){for(var b=[],c=esprima.parse(a,{comment:!0,range:!0}),d=0;d<c.comments.length;d++){var e=c.comments[d];if("Block"==e.type&&e.value.includes("Application Interface")){var f="",g="";if(5==e.value.indexOf("Application Interface")){var h=e.value.substring(28),i=h.indexOf("\n");f=h.substring(0,i)}else{var h=e.value.substring(29),i=h.indexOf("\n");f=h.substring(0,i-1)}g=e.value.includes("dirty")?"dirty":"working",b.push({name:f,range:[e.range[0],e.range[1]],state:g})}else"Line"==e.type&&b.length>0&&e.value.includes(b[b.length-1].name)&&(b[b.length-1].range.push(e.range[0]),b[b.length-1].range.push(e.range[1]))}return b},b=function(a,b,c){for(var d=a.length-1;d>=0;d--)"working"==a[d].state&&-1==b.indexOf(a[d].name)&&(console.log(d),c=c.slice(0,a[d].range[1]-2)+"* dirty\n "+c.slice(a[d].range[1]-2,a[d].range[1])+"\n/*"+c.slice(a[d].range[1],a[d].range[2])+"*/\n"+c.slice(a[d].range[2]));return c},c=function(a,b){for(var c=a.length-1;c>=0;c--)"dirty"==a[c].state&&(b=b.slice(0,a[c].range[0]-1)+b.slice(a[c].range[3]+1));return b};return{getApiList:a,markAsDirty:b,deleteDirtyApis:c}}).controller("showAPIsCtrl",["$scope","$resource","$uibModalInstance","allAPIs","implementedAPIs","projectName",function(a,b,c,d,e,f){a.allAPIs=d,a.implementedAPIs=angular.copy(e),a.apisToAdd=[],a.currentProject=f,console.log(e),a.ok=function(){c.close(a.apisToAdd)},a.cancel=function(){c.dismiss("cancel")},a.toggleAPISelection=function(b){var c=a.apisToAdd.indexOf(b);c>-1?a.apisToAdd.splice(c,1):a.apisToAdd.push(b)}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("project",{url:"/project/:project",templateUrl:"app/project/project.html",controller:"ProjectCtrl",resolve:{project:["$stateParams","$resource",function(a,b){return b("/api/projects/"+a.project).get().$promise}],files:["$stateParams","$resource",function(a,b){return b("/api/projects/"+a.project+"/files").get().$promise}],resources:["$stateParams","$resource",function(a,b){return b("/api/projects/"+a.project+"/files/resources").get().$promise}]}})}]),angular.module("koodainApp").controller("ProjectsCtrl",["$scope","$http","$resource","$uibModal","Notification","projectlist","$timeout",function(a,b,c,d,e,f,g){var h=function(a){console.log(a.name),c("/api/projects/"+a.name+"/files/package.json").get().$promise.then(function(b){console.log(b.content);var c=JSON.parse(b.content);a.version=c.version,a.description=c.description},function(b){console.log("This is bad "+b),a.version="unknown",a.description="no description found"})},i=function(){angular.forEach(a.projects,function(a,b,c){h(a)})},j=function(){g(function(){$.fn.matchHeight._applyDataApi()},100)},k=function(){a.projects=f,i(),j()};k(),a.newProj={name:"",description:""},a.createProject=function(){var b=c("/api/projects"),d=new b({name:a.newProj.name});d.$save().then(function(){c("/api/projects/"+a.newProj.name+"/files/package.json").get().$promise.then(function(b){var d=JSON.parse(b.content);a.newProj.version=d.version,d.description=a.newProj.description;var e=c("/api/projects/"+a.newProj.name+"/files/:name",null,{update:{method:"PUT"}});b.content=JSON.stringify(d,void 0,2),l(e,b),a.projects.push(a.newProj),a.newProj={name:"",description:""}},function(a){e.error(res.data.error)})},function(a){e.error(a.data.error)})};var l=function(a,b){var c=a.update({name:"package.json"},b);console.log(c.$promise.$$state)};a.deleteProjectModal=function(b){d.open({controller:"deleteProjectCtrl",templateUrl:"deleteproject.html",resolve:{project:function(){return b}}}).result.then(function(d){console.log(name);var e=c("/api/projects/"+d);e.remove();var f=a.projects.indexOf(b);a.projects.splice(f,1)})}}]).controller("deleteProjectCtrl",["$scope","$uibModalInstance","project",function(a,b,c){a.project=c,a.ok=function(){b.close(a.project.name)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("projects",{url:"/projects",templateUrl:"app/projects/projects.html",controller:"ProjectsCtrl",resolve:{projectlist:["$stateParams","$resource",function(a,b){return b("/api/projects/").query().$promise}]}})}]),angular.module("koodainApp").service("DeviceManager",["$http","$resource","$q","deviceManagerUrl",function(a,b,c,d){function e(a,b){return b.id==a}function f(a,b){return b.type==a}function g(a,b){if(!a)return!0;for(var c=0;c<a.length;c++)if(!b.classes||-1===b.classes.indexOf(a[c]))return!1;return!0}function h(a,b){return"not"===a.key?!q(b,a.value):!0}function i(a,b){if(!a)return!0;for(var c=0;c<a.length;c++)if(!h(a[c],b))return!1;return!0}function j(a,b){return a.tag&&"*"!==a.tag&&!f(a.tag,b)?!1:g(a.classList,b)?a.id&&!e(a.id,b)?!1:i(a.pseudos,b)?a.attributes&&!k(a.attributes,b)?!1:!0:!1:!1}function k(a,b){for(var c=0;c<a.length;c++)if(!l(a[c],b))return!1;return!0}function l(a,b){return a.test(b[a.key])}function m(a,b){for(var c=0;c<a.length;c++)if(!j(a[c],b))return!1;return!0}function n(a,b){for(var c=b.expressions,d=0;d<c.length;d++)if(m(c[d],a))return!0;return!1}function o(a,b,c){if("string"==typeof b&&(b=Slick.parse(b)),!b)return[];var d=a.apps;if(!d)return!1;for(var e=!1,f=0;f<d.length;f++)n(d[f],b)&&(c||-1!=v.devices.indexOf(a.id)||v.devices.push(a.id),v.apps.push(d[f].id),e=!0);return e}function p(a,b){if("string"==typeof b&&(b=Slick.parse(b)),!b)return[];for(var c=b.expressions,d=0;d<c.length;d++)if(m(c[d],a))return v.devices.push(a.id),!0;return!1}function q(a,b,c){return b&&!p(a,b)?!1:c&&!o(a,c,b)?!1:!0}function r(a,b,c){if(v={devices:[],apps:[]},!b&&!c)return v;for(var d in a)q(a[d],b,c);return v}function s(){return c(function(b,c){a({method:"GET",url:"/api/visualdevices"}).then(function(a){for(var c=a.data,d={},e=0;e<c.length;e++){c[e].coords={x:e%10*200,y:200*Math.floor(e/10)};var f=c[e];d[f.id]=f}b(d)})})}function t(a){return s().then(function(b){for(var c in b)a[c]=b[c];return a})}function u(b){return b||(b="FOR device IN devices RETURN device"),a({method:"GET",url:d,params:{device:b}}).then(function(a){return console.log(a),a.data})}var v={};return function(a){function b(a,b){return c.devices(a,b)}var c=devicelib(a);return{queryDevicess:u,queryDevices:b,filter:r,addMockDevicesTo:t}}}]),angular.module("koodainApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop;return d.save(a,function(b){return e.put("token",b.token),g=d.get(),c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},getToken:function(){return e.get("token")}}}]),angular.module("koodainApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("koodainApp").directive("liotFooter",function(){return{restrict:"E",scope:{},link:function(a,b,c){a.currentPage=c.currentPage,a.steps=[{pagename:"addDevice",desc:"Add a device to network",substeps:!0},{pagename:"home",desc:"Monitor device(s) and application(s)",substeps:!1},{pagename:"projects",desc:"Explore/Create project(s)",substeps:!1},{pagename:"projectcode",desc:"Edit code, capabilities, APIs",substeps:!0},{pagename:"deploy",desc:"Deploy/update applications",substeps:!1},{pagename:"APIs",desc:"Add or Edit API templates",substeps:!1}]},templateUrl:"components/footer/footer.html"}}),angular.module("koodainApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("koodainApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("koodainApp").controller("NavbarCtrl",["$scope","$location","$state","Auth",function(a,b,c,d){a.$state=c,a.menu=[{title:"Home",link:"/"},{title:"Projects",link:"/projects"},{title:"Deploy",link:"/deploy"},{title:"APIs",link:"/api-descr"}],a.isCollapsed=!0,a.isLoggedIn=d.isLoggedIn,a.isAdmin=d.isAdmin,a.getCurrentUser=d.getCurrentUser,a.logout=function(){d.logout(),b.path("/login")},a.isActive=function(a){return(b.path()+"/").startsWith(a+"/")}}]),angular.module("koodainApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Login</h1><p>Accounts are reset on server restart from<code>server/config/seed.js</code>. Default account is<code>test@test.com</code>/<code>test</code></p><p>Admin account is<code>admin@admin.com</code>/<code>admin</code></p></div><div class=col-sm-12><form name=form ng-submit=login(form) novalidate class=form><div class=form-group><label>Email</label><input name=email ng-model=user.email class="form-control"></div><div class=form-group><label>Password</label><input type=password name=password ng-model=user.password class="form-control"></div><div class="form-group has-error"><p ng-show="form.email.$error.required &amp;&amp; form.password.$error.required &amp;&amp; submitted" class=help-block>Please enter your email and password.</p><p class=help-block>{{ errors.other }}</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-login">Login</button> <a href=/signup class="btn btn-default btn-lg btn-register">Register</a></div><hr><div><a href="" ng-click=loginOauth(&quot;facebook&quot;) class="btn btn-facebook"><i class="fa fa-facebook"></i> Connect with Facebook</a> <a href="" ng-click=loginOauth(&quot;google&quot;) class="btn btn-google-plus"><i class="fa fa-google-plus"></i> Connect with Google+</a> <a href="" ng-click=loginOauth(&quot;twitter&quot;) class="btn btn-twitter"><i class="fa fa-twitter"></i> Connect with Twitter</a></div></form></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form name=form ng-submit=changePassword(form) novalidate class=form><div class=form-group><label>Current Password</label><input type=password name=password ng-model=user.oldPassword mongoose-error="" class="form-control"><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword ng-model=user.newPassword ng-minlength=3 required class="form-control"><p ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) &amp;&amp; (form.newPassword.$dirty || submitted)" class=help-block>Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button type=submit class="btn btn-lg btn-primary">Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Sign up</h1></div><div class=col-sm-12><form name=form ng-submit=register(form) novalidate class=form><div ng-class="{ &quot;has-success&quot;: form.name.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.name.$invalid &amp;&amp; submitted }" class=form-group><label>Name</label><input name=name ng-model=user.name required class="form-control"><p ng-show="form.name.$error.required &amp;&amp; submitted" class=help-block>A name is required</p></div><div ng-class="{ &quot;has-success&quot;: form.email.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.email.$invalid &amp;&amp; submitted }" class=form-group><label>Email</label><input type=email name=email ng-model=user.email required mongoose-error="" class="form-control"><p ng-show="form.email.$error.email &amp;&amp; submitted" class=help-block>Doesn\'t look like a valid email.</p><p ng-show="form.email.$error.required &amp;&amp; submitted" class=help-block>What\'s your email address?</p><p ng-show=form.email.$error.mongoose class=help-block>{{ errors.email }}</p></div><div ng-class="{ &quot;has-success&quot;: form.password.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.password.$invalid &amp;&amp; submitted }" class=form-group><label>Password</label><input type=password name=password ng-model=user.password ng-minlength=3 required mongoose-error="" class="form-control"><p ng-show="(form.password.$error.minlength || form.password.$error.required) &amp;&amp; submitted" class=help-block>Password must be at least 3 characters.</p><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.password }}</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-login">Sign up</button> <a href=/login class="btn btn-default btn-lg btn-register">Login</a></div><hr><div><a href="" ng-click=loginOauth(&quot;facebook&quot;) class="btn btn-facebook"><i class="fa fa-facebook"></i> Connect with Facebook</a> <a href="" ng-click=loginOauth(&quot;google&quot;) class="btn btn-google-plus"><i class="fa fa-google-plus"></i> Connect with Google+</a> <a href="" ng-click=loginOauth(&quot;twitter&quot;) class="btn btn-twitter"><i class="fa fa-twitter"></i> Connect with Twitter</a></div></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li ng-repeat="user in users" class=list-group-item><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span><a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/api-descr/api-descr.html",'<div ng-include="&quot;components/navbar/navbar.html&quot;"></div><div class="container"><div class="row"><div class="col-sm-9"><div class="liot-title">REST API templates</div><div ng-init="visibleLimit = 6" class="row col-sm-12"><ul ng-repeat="api in apis | limitTo: visibleLimit as results" data-mh="apiGroup" class="list-unstyled col-sm-6 col-md-6 col-lg-6 top-buffer"><div class="liot-item"><div class="liot-item-title clearfix"><p class="pull-left">{{api.name}}</p><div role="group" class="btn-group pull-right"><a ng-href="{{deviceManagerUrl+\'/apis/\'+api.name}}" target="_blank" class="btn btn-xs btn-primary"><i class="fa fa-bars"></i></a><a ng-href="/swagger-editor/#/?backend={{deviceManagerUrl+\'/apis/\'+api.name | encodeUri}}" |="|" target="_blank" class="btn btn-xs btn-primary"><i class="fa fa-edit"></i></a><a ng-click="deleteApi(api)" class="btn btn-xs btn-primary"><i class="fa fa-trash"></i></a></div></div><p>{{api.description}}</p><br/><span>Required capabilities: {{api.devcap}}</span></div></ul></div></div><div class="col-sm-3">      <div><div class="liot-title">Create new</div><br/><span for="apiClass">Name of template:</span> <input type="text" required="required" id="apiClass" name="apiClass" ng-model="newApiClass" placeholder="template name"/><br/><br/><span for="apiSelect"> Required device capability:</span><select ng-model="selectedDevCap" id="apiSelect"><option ng-repeat="devCap in devCaps">{{devCap.name}}</option></select> <br/><br/><button value="Create" ng-disabled="!newApiClass" ng-click="newApi()" class="btn liot-button">Create</button></div></div></div></div><!--Add the footer and specify name of current page (as found in components/footer/footer.controller.js)--><liot-footer current-page="APIs"></liot-footer>'),a.put("app/deploy/deploy.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class="container ng-cloak"><ul ng-init="tab=\'deploy\'" class="nav nav-tabs"><li><a ng-click="tab=\'deploy\'">Deploy</a></li><li><a ng-click="tab=\'update\'">Update</a></li></ul><div class=tab-content><div id=DeployView ng-show="tab===\'deploy\'" ng-controller=DeployCtrl class=container><br><div class=row><div class=col-sm-6><strong>LiquidIoT devices</strong><div id=devGrid ui-grid=gridOptions ui-grid-selection=ui-grid-selection ui-grid-resize-columns=ui-grid-resize-columns class=grid></div></div><div class=col-sm-6><strong>LiquidIoT projects</strong><div id=projGrid ui-grid=projGridOptions ui-grid-selection=ui-grid-selection ui-grid-resize-columns=ui-grid-resize-columns class=grid></div></div></div><div class=row><div class=col-sm-12><span></span></div></div><div class=row><div class=col-sm-12><button type=submit ng-click=clearSelection() class="btn btn-primary">Clear selection</button><span></span><button ng-click=openMapView() class="btn btn-primary">View in Map</button><span></span><button ng-click=stageDeploy() class="btn btn-primary">Deploy</button></div></div></div><div ng-if="tab === \'update\'" id=UpdateView ng-controller=ModifyAppInstCtrl class=container><br><div class=row><div class=col-sm-9><table st-table=displayed st-safe-src=installedApps class="table table-striped table-bordered"><thread><tr><th select-all-rows=select-all-rows all-data-rows=installedApps selected-rows=selectedAppInstances ng-click=selectAllApps()></th><th>Name</th><th>Version</th><th>Device</th><th>Status</th><th>Location</th><th class=col-sm-3>Possible actions</th></tr><tr><th></th><th><input st-search=name placeholder="app name" type=search class="input-sm form-control"></th><th><input st-search=version placeholder=version type=search class="input-sm form-control"></th><th><input st-search=device.name placeholder="host device" type=search class="input-sm form-control"></th><th><input st-search=status placeholder="app status" type=search class="input-sm form-control"></th><th><input st-search=device.location.tag placeholder=location type=search class="input-sm form-control"></th><th></th></tr></thread><tbody><tr ng-repeat="app in displayed"><td select-row=select-row row-data=app ng-click=selectApp(app)></td><td>{{app.name.replace(\'liquidiot-\', \'\')}}</td><td>{{app.version}}</td><td>{{app.device.name}}</td><td>{{app.status}}</td><td>{{app.device.location.tag}}</td><td><div ng-if="app.status !==\'installed\'" role=group class=btn-group><button ng-if="app.status===\'paused\'" ng-click="setAppStatus(app.device, app, \'running\')" class="btn-sm btn-primary"><i class="fa fa-play"></i></button><button ng-if="app.status===\'running\'" ng-click="setAppStatus(app.device, app, \'paused\')" class="btn-sm btn-primary"><i class="fa fa-pause"></i></button><button ng-if=app.canRollback ng-click="rollbackApp(app.device, app)" class="btn-sm btn-warning"><i class="fa fa-rotate-left"></i></button><button ng-click="updateApp(app.device, app)" class="btn-sm btn-success"><i class="fa fa-rotate-right"></i></button><button ng-click="removeApp(app.device, app)" class="btn-sm btn-danger"><i class="fa fa-trash"></i></button><button ng-click="openLogModal(app.device, app)" class="btn-sm btn-default"><i class="fa fa-list"></i></button></div><i ng-if="app.status ===\'installed\'" style="color: red" class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span ng-if="app.status ===\'installed\'" style="color: red">Trying to run the application</span></td></tr></tbody></table><button type=submit ng-click=clearSelections() class="btn btn-primary">Clear selection<span></span></button><button ng-click=openMapView() class="btn btn-primary">View in Map<span></span></button><button ng-click=modifySelectedApps() class="btn btn-primary">Update</button></div><div class=col-sm-3><button ng-click=showQueryWindow() class="btn-sm btn-primary"><i class="fa fa-filter">Advanced search</i></button></div></div><div class=row><div class=col-sm-12><span></span></div></div></div><script type=text/ng-template id=deploysheet.html><div aria-label="Applications to deploy" class="md-dialog"><form class="ng-cloak"><md-toolbar style="background-color: #46c8ff"><div class="container md-toolbar-tools"><h2>Applications to deploy</h2><span class="flex"></span><md-button ng-click="cancel()" class="md-icon-button"><md-icon md-font-icon="fa-window-close" class="fa"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="container md-dialog-content"><ul ng-repeat="dep in stagedDeployments" class="list-unstyled"><li><md-checkbox ng-model="dep.confirmDeployment">Deploy {{dep.projectName}} to {{dep.strTargets}}</md-checkbox></li></ul></div><div ng-show="showResults" class="container"><md-progress-circular md-mode="indeterminate" md-diameter="20px" ng-disabled="deploymentDone"></md-progress-circular><ul ng-repeat="msg in results" class="list-unstyled">                           <li><p>{{msg}}</p></li></ul></div></md-dialog-content><md-dialog-actions layout="row"><span class="flex"></span><md-button ng-click="deploy()" class="md-autofocus">Deploy</md-button><md-button ng-click="cancel()" class="md-autofocus">Close</md-button></md-dialog-actions></form></div></script><script type=text/ng-template id=updateSheet.html><div aria-label="Selected applications" class="md-dialog"><form class="ng-cloak"><md-toolbar style="background-color: #46c8ff"><div class="container md-toolbar-tools"><h2>Applications selected for update</h2><span class="flex"></span><md-button ng-click="cancel()" class="md-icon-button"><md-icon md-font-icon="fa-window-close" class="fa"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="container md-dialog-content"><ul ng-repeat="app in installedApps" class="list-unstyled"><li ng-init="app.confirmModification = true" ng-if="app.isSelected &amp;&amp; app.isSelected===true"><md-checkbox ng-model="app.confirmModification">{{app.name.replace(\'liquidiot-\',\'\')}} in {{app.device.name}} </md-checkbox></li></ul><div ng-show="showResults" class="container"><md-progress-circular md-mode="indeterminate" md-diameter="20px" ng-disabled="modificationsDone">                     </md-progress-circular><ul ng-repeat="msg in results" class="list-unstyled">                           <li><p>{{msg}}</p></li></ul></div></div></md-dialog-content><md-dialog-actions layout="row"><span class="flex"></span><div role="group" class="btn-group">                               <button ng-click="setAllAppsStatus(\'running\')" class="btn-sm btn-primary"><i class="fa fa-play">Run</i></button><button ng-click="setAllAppsStatus(\'paused\')" class="btn-sm btn-primary"><i class="fa fa-pause">Pause</i></button><button ng-click="rollbackAllApps()" class="btn-sm btn-primary"><i class="fa fa-rotate-left">Rollback</i></button><button ng-click="updateAllApps()" class="btn-sm btn-primary"><i class="fa fa-rotate-right">Update</i></button><button ng-click="removeAllApps()" class="btn-sm btn-danger"><i class="fa fa-trash">Remove</i></button><button ng-click="cancel()" class="btn-sm btn-primary">Close</button></div></md-dialog-actions></form></div></script><script type=text/ng-template id=mapSheet.html><div id="MapView" class="container"><div id="network"><vis-network data="graphData" options="graphOptions" events="graphEvents" component="network"></vis-network></div><p><div role="group" class="btn-group"><button ng-click="loadDevices()" class="btn btn-default"><span class="fa fa-refresh"></span></button><button ng-click="camera.fit()" class="btn btn-default"><span class="fa fa-arrows-alt"> fit camera</span></button><button ng-click="camera.fitOnSelectedNodes()" class="btn btn-default"><span class="fa fa-arrows-alt"> fit camera on selection</span></button><button ng-click="camera.crawl()" ng-show="isCrawlingPossible" class="btn btn-default"><span class="fa fa-arrows-alt"> crawl in selection</span></button></div></p></div></script><script type=text/ng-template id=querySheet.html><div aria-label="Advanced Query" class="md-dialog"><form class="ng-cloak"><md-toolbar style="background-color: #46c8ff"><div class="container md-toolbar-tools"><h2>Advanced filter with query</h2><span class="flex"></span><md-button ng-click="cancel()" class="md-icon-button"><md-icon md-font-icon="fa-window-close" class="fa"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="container"><form></form><div class="form-group"><label for="queryStr">query:</label><textarea rows="5" id="queryStr" ng-model="userQuery" placeholder="Example query: FOR dev in devices return dev" class="form-control"></textarea><button ng-click="executeQuery()" class="btn-sm btn-primary">Execute</button></div><form></form><div class="form-group"><label for="result">result:</label><textarea rows="5" id="result" ng-model="queryResult" placeholder="Query results" class="form-control"></textarea></div></div></md-dialog-content><md-dialog-actions layout="row"><span class="flex"></span><div role="group" class="btn-group">                               <md-button ng-click="applyQueryResult()" class="md-autofocus">Apply query result</md-button><md-button ng-click="cancel()" class="md-autofocus">Cancel</md-button></div></md-dialog-actions></form></div></script><!-- Application log modal dialog--><script type=text/ng-template id=applog.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Log of <strong>{{app.name}}</strong> at <strong>{{device.name}}</strong></h4></div><div class="modal-body"><pre>{{log}}</pre></div></script><div id=MapView ng-if="tab===\'mapview\'" ng-controller=MapViewCtrl class=container><div class=row><div class=col-sm-12><div class=row></div><div id=network><vis-network data=graphData options=graphOptions events=graphEvents component=network></vis-network></div><p><div role=group class=btn-group><button ng-click=loadDevices() class="btn btn-default"><span class="fa fa-refresh"></span></button><button ng-click=camera.fit() class="btn btn-default"><span class="fa fa-arrows-alt">fit camera</span></button><button ng-click=camera.fitOnSelectedNodes() class="btn btn-default"><span class="fa fa-arrows-alt">fit camera on selection</span></button><button ng-click=camera.crawl() ng-show=isCrawlingPossible class="btn btn-default"><span class="fa fa-arrows-alt">crawl in selection</span></button></div></p></div></div></div></div></div><!--Add the footer and specify name of current page (as found in components/footer/footer.controller.js)--><liot-footer current-page=deploy></liot-footer><!--<liot-footer current-page=\'mydeploy\'></liot-footer>-->'),
a.put("app/deploy/griddeploy.html",'<div id=DeployView ng-show="tab===\'deploy\'" ng-controller=DeployCtrl class=container><br><div class=row><div class=col-sm-6><strong>LiquidIoT devices</strong><div id=devGrid ui-grid=gridOptions ui-grid-selection=ui-grid-selection ui-grid-resize-columns=ui-grid-resize-columns class=grid></div></div><div class=col-sm-6><strong>LiquidIoT projects</strong><div id=projGrid ui-grid=projGridOptions ui-grid-selection=ui-grid-selection ui-grid-resize-columns=ui-grid-resize-columns class=grid></div></div></div><div class=row><div class=col-sm-12><span></span></div></div><div class=row><div class=col-sm-12><button type=submit ng-click=clearSelection() class="btn btn-primary">Clear selection</button><span></span><button ng-click=openMapView() class="btn btn-primary">View in Map</button><span></span><button ng-click=stageDeploy() class="btn btn-primary">Deploy</button></div></div></div><div ng-if="tab === \'update\'" id=UpdateView ng-controller=ModifyAppInstCtrl class=container><br><div class=row><div class=col-sm-9><table st-table=displayed st-safe-src=installedApps class="table table-striped table-bordered"><thread><tr><th select-all-rows=select-all-rows all-data-rows=installedApps selected-rows=selectedAppInstances ng-click=selectAllApps()></th><th>Name</th><th>Version</th><th>Device</th><th>Status</th><th>Location</th><th class=col-sm-3>Possible actions</th></tr><tr><th></th><th><input st-search=name placeholder="app name" type=search class="input-sm form-control"></th><th><input st-search=version placeholder=version type=search class="input-sm form-control"></th><th><input st-search=device.name placeholder="host device" type=search class="input-sm form-control"></th><th><input st-search=status placeholder="app status" type=search class="input-sm form-control"></th><th><input st-search=device.location.tag placeholder=location type=search class="input-sm form-control"></th><th></th></tr></thread><tbody><tr ng-repeat="app in displayed"><td select-row=select-row row-data=app ng-click=selectApp(app)></td><td>{{app.name.replace(\'liquidiot-\', \'\')}}</td><td>{{app.version}}</td><td>{{app.device.name}}</td><td>{{app.status}}</td><td>{{app.device.location.tag}}</td><td><div ng-if="app.status !==\'installed\'" role=group class=btn-group><button ng-if="app.status===\'paused\'" ng-click="setAppStatus(app.device, app, \'running\')" class="btn-sm btn-primary"><i class="fa fa-play"></i></button><button ng-if="app.status===\'running\'" ng-click="setAppStatus(app.device, app, \'paused\')" class="btn-sm btn-primary"><i class="fa fa-pause"></i></button><button ng-if=app.canRollback ng-click="rollbackApp(app.device, app)" class="btn-sm btn-warning"><i class="fa fa-rotate-left"></i></button><button ng-click="updateApp(app.device, app)" class="btn-sm btn-success"><i class="fa fa-rotate-right"></i></button><button ng-click="removeApp(app.device, app)" class="btn-sm btn-danger"><i class="fa fa-trash"></i></button><button ng-click="openLogModal(app.device, app)" class="btn-sm btn-default"><i class="fa fa-list"></i></button></div><i ng-if="app.status ===\'installed\'" style="color: red" class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span ng-if="app.status ===\'installed\'" style="color: red">Trying to run the application</span></td></tr></tbody></table><button type=submit ng-click=clearSelections() class="btn btn-primary">Clear selection<span></span></button><button ng-click=openMapView() class="btn btn-primary">View in Map<span></span></button><button ng-click=modifySelectedApps() class="btn btn-primary">Update</button></div><div class=col-sm-3><button ng-click=showQueryWindow() class="btn-sm btn-primary"><i class="fa fa-filter">Advanced search</i></button></div></div><div class=row><div class=col-sm-12><span></span></div></div></div><script type=text/ng-template id=deploysheet.html><div aria-label="Applications to deploy" class="md-dialog"><form class="ng-cloak"><md-toolbar style="background-color: #46c8ff"><div class="container md-toolbar-tools"><h2>Applications to deploy</h2><span class="flex"></span><md-button ng-click="cancel()" class="md-icon-button"><md-icon md-font-icon="fa-window-close" class="fa"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="container md-dialog-content"><ul ng-repeat="dep in stagedDeployments" class="list-unstyled"><li><md-checkbox ng-model="dep.confirmDeployment">Deploy {{dep.projectName}} to {{dep.strTargets}}</md-checkbox></li></ul></div><div ng-show="showResults" class="container"><md-progress-circular md-mode="indeterminate" md-diameter="20px" ng-disabled="deploymentDone"></md-progress-circular><ul ng-repeat="msg in results" class="list-unstyled">                           <li><p>{{msg}}</p></li></ul></div></md-dialog-content><md-dialog-actions layout="row"><span class="flex"></span><md-button ng-click="deploy()" class="md-autofocus">Deploy</md-button><md-button ng-click="cancel()" class="md-autofocus">Close</md-button></md-dialog-actions></form></div></script><script type=text/ng-template id=updateSheet.html><div aria-label="Selected applications" class="md-dialog"><form class="ng-cloak"><md-toolbar style="background-color: #46c8ff"><div class="container md-toolbar-tools"><h2>Applications selected for update</h2><span class="flex"></span><md-button ng-click="cancel()" class="md-icon-button"><md-icon md-font-icon="fa-window-close" class="fa"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="container md-dialog-content"><ul ng-repeat="app in installedApps" class="list-unstyled"><li ng-init="app.confirmModification = true" ng-if="app.isSelected &amp;&amp; app.isSelected===true"><md-checkbox ng-model="app.confirmModification">{{app.name.replace(\'liquidiot-\',\'\')}} in {{app.device.name}} </md-checkbox></li></ul><div ng-show="showResults" class="container"><md-progress-circular md-mode="indeterminate" md-diameter="20px" ng-disabled="modificationsDone">                     </md-progress-circular><ul ng-repeat="msg in results" class="list-unstyled">                           <li><p>{{msg}}</p></li></ul></div></div></md-dialog-content><md-dialog-actions layout="row"><span class="flex"></span><div role="group" class="btn-group">                               <button ng-click="setAllAppsStatus(\'running\')" class="btn-sm btn-primary"><i class="fa fa-play">Run</i></button><button ng-click="setAllAppsStatus(\'paused\')" class="btn-sm btn-primary"><i class="fa fa-pause">Pause</i></button><button ng-click="rollbackAllApps()" class="btn-sm btn-primary"><i class="fa fa-rotate-left">Rollback</i></button><button ng-click="updateAllApps()" class="btn-sm btn-primary"><i class="fa fa-rotate-right">Update</i></button><button ng-click="removeAllApps()" class="btn-sm btn-danger"><i class="fa fa-trash">Remove</i></button><button ng-click="cancel()" class="btn-sm btn-primary">Close</button></div></md-dialog-actions></form></div></script><script type=text/ng-template id=mapSheet.html><div id="MapView" class="container"><div id="network"><vis-network data="graphData" options="graphOptions" events="graphEvents" component="network"></vis-network></div><p><div role="group" class="btn-group"><button ng-click="loadDevices()" class="btn btn-default"><span class="fa fa-refresh"></span></button><button ng-click="camera.fit()" class="btn btn-default"><span class="fa fa-arrows-alt"> fit camera</span></button><button ng-click="camera.fitOnSelectedNodes()" class="btn btn-default"><span class="fa fa-arrows-alt"> fit camera on selection</span></button><button ng-click="camera.crawl()" ng-show="isCrawlingPossible" class="btn btn-default"><span class="fa fa-arrows-alt"> crawl in selection</span></button></div></p></div></script><script type=text/ng-template id=querySheet.html><div aria-label="Advanced Query" class="md-dialog"><form class="ng-cloak"><md-toolbar style="background-color: #46c8ff"><div class="container md-toolbar-tools"><h2>Advanced filter with query</h2><span class="flex"></span><md-button ng-click="cancel()" class="md-icon-button"><md-icon md-font-icon="fa-window-close" class="fa"></md-icon></md-button></div></md-toolbar><md-dialog-content><div class="container"><form></form><div class="form-group"><label for="queryStr">query:</label><textarea rows="5" id="queryStr" ng-model="userQuery" placeholder="Example query: FOR dev in devices return dev" class="form-control"></textarea><button ng-click="executeQuery()" class="btn-sm btn-primary">Execute</button></div><form></form><div class="form-group"><label for="result">result:</label><textarea rows="5" id="result" ng-model="queryResult" placeholder="Query results" class="form-control"></textarea></div></div></md-dialog-content><md-dialog-actions layout="row"><span class="flex"></span><div role="group" class="btn-group">                               <md-button ng-click="applyQueryResult()" class="md-autofocus">Apply query result</md-button><md-button ng-click="cancel()" class="md-autofocus">Cancel</md-button></div></md-dialog-actions></form></div></script><!-- Application log modal dialog--><script type=text/ng-template id=applog.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Log of <strong>{{app.name}}</strong> at <strong>{{device.name}}</strong></h4></div><div class="modal-body"><pre>{{log}}</pre></div></script>'),a.put("app/home/home.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-lg-12><div class=liot-title>Devices in the system: {{devices.length}}</div><hr></div></div><div class="row col-lg-12"><div id=MapView ng-controller=MapViewCtrl class=container><div id=network><vis-network data=graphData options=graphOptions events=graphEvents component=network></vis-network></div><p><div role=group class=btn-group><button ng-click=loadDevices() class="btn btn-default"><span class="fa fa-refresh"></span></button><button ng-click=camera.fit() class="btn btn-default"><span class="fa fa-arrows-alt">fit camera</span></button><button ng-click=camera.fitOnSelectedNodes() class="btn btn-default"><span class="fa fa-arrows-alt">fit camera on selection</span></button><button ng-click=camera.crawl() ng-show=isCrawlingPossible class="btn btn-default"><span class="fa fa-arrows-alt">crawl in selection</span></button></div></p></div></div></div><!--Add the footer and specify name of current page (as found in components/footer/footer.controller.js)--><liot-footer current-page=home></liot-footer><!-- Application log modal dialog--><script type=text/ng-template id=applog.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="liot-item-title">Log of {{app.name}} at {{device.name}}</h4></div><div class="modal-body"><pre>{{log}}</pre></div></script>'),a.put("app/hosts/hosts.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h2>Hosts</h2><table class="table table-bordered table-hover"><thead><th>name</th><th>build status</th></thead><tr ng-repeat="host in hosts"><td>{{host.name}}</td><td>{{host.buildStatus}}</td></tr></table></div><div class=com-sm-12><button ng-click=openNewHostModal() class="btn btn-primary"><i class="fa fa-plus">New Host</i></button></div></div></div><script type=text/ng-template id=newhost.html><div class="modal-header"><button ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">New Host</h4></div><div class="modal-body"><form role="form" name="newhostform"><div class="form-group"><label for="hostname">Host name:</label><input type="text" required="required" ng-pattern="/^[a-z][a-z0-9-]*$/" id="hostname" name="hostname" placeholder="" ng-model="host.name" class="form-control"/><span ng-if="newhostform.hostname.$error.pattern" class="error">Host name must match <code>[a-z][a-z0-9]*</code></span><span ng-if="newhostform.hostname.$error.required || !newhostform.hostname.$invalid"><i class="fa"></i></span></div><div ng-if="errorLog"><label style="color:red">The following error happened while creating the host</label><pre>{{errorLog}}</pre></div></form></div><div class="modal-footer"><button ng-click="cancel()" class="btn btn-default">Cancel</button><button ng-disabled="newhostform.hostname.$invalid" ng-click="createHost()" class="btn btn-primary">Create host</button></div></script><div ng-include=&quot;components/footer/footer.html&quot;></div>'),a.put("app/main/main.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h3>Projects</h3><p>Choose a project or create a new one</p><ul ng-repeat="project in projects" class="nav nav-tabs nav-stacked col-md-3 col-lg-3 col-sm-4"><li class=project><div class=col-sm-10><a ng-href=/project/{{project.name}}>{{project.name}}</a></div><div class=col-sm-2><!--button.btn.btn-danger(ng-click="deleteProject(project)")--><button ng-click=deleteProjectModal(project) class="btn btn-danger"><i class="fa fa-trash"></i></button></div></li></ul></div><div class=col-sm-12><button ng-click=openNewProjectModal() class="btn btn-primary mainbutton"><i class="fa fa-plus"></i> New Project</button></div></div></div><div ng-include=&quot;components/footer/footer.html&quot;></div><!-- Template for the create new project modal dialog.--><!-- https://docs.angularjs.org/api/ng/directive/script--><script type=text/ng-template id=newproject.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">New Project</h4></div><div class="modal-body"><form role="form" name="newprojectform" ng-submit="ok()"><div class="form-group"><label for="projectname">Project name:</label><input type="text" required="required" ng-pattern="/^[a-z][a-z0-9]*$/" id="projectname" name="projectname" placeholder="" ng-model="newproject.name" class="form-control"/><span ng-if="newprojectform.projectname.$error.pattern" class="error">Project name must match <code>[a-z][a-z0-9]*</code></span><span ng-if="newprojectform.projectname.$error.required || !newprojectform.projectname.$invalid"><i class="fa"></i></span></div></form></div><div class="modal-footer"><button type="submit" ng-click="cancel()" class="btn btn-default">Cancel</button><button type="submit" ng-disabled="newprojectform.projectname.$invalid" ng-click="ok()" class="btn btn-primary">Create project</button></div></script><!-- Template for the delete project modal dialog.--><!-- https://docs.angularjs.org/api/ng/directive/script--><script type=text/ng-template id=deleteproject.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Delete Project</h4></div><div class="modal-body"><form role="form" name="newprojectform" ng-submit="ok()"><div class="form-group"><label for="projectname">If you sure you want to delete the project enter the project name: <strong style="color:red;">{{project.name}}</strong></label><input type="text" required="required" ng-pattern="/^[a-z][a-z0-9]*$/" id="projectname" name="projectname" placeholder="" ng-model="projectName" class="form-control"/><span ng-if="newprojectform.projectname.$error.pattern" class="error">Project name must match <code>[a-z][a-z0-9]*</code></span><span ng-if="newprojectform.projectname.$error.required || !newprojectform.projectname.$invalid"><i class="fa"></i></span></div></form></div><div class="modal-footer"><button type="submit" ng-click="cancel()" class="btn btn-default">Cancel</button><button type="submit" ng-disabled="newprojectform.projectname.$invalid || (project.name !== projectName)" ng-click="ok()" class="btn btn-danger">Delete Project</button></div></script>'),a.put("app/project/project.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><div class=liot-title>{{project.name}}</div></div></div><div class=row><div class=col-sm-3><div class=sidebar><div class="files container">Source<ul><li ng-repeat="file in files.files | filter:{isDirectory: false, name: \'!agent.js\'} | orderBy:\'name\'" ng-class="{active: activeFile.name===file.name}" ng-click=openFile(file) class=project-file>{{file.name}} <i ng-if="updating[file.name].status===0" class="fa fa-circle-o-notch fa-spin"></i><i ng-if="updating[file.name].status===2" class="fa fa-warning"></i></li><li><a ngf-select=uploadFile($file)>Add new file</a></li></ul></div><div class=container>Resources<ul><li ng-repeat="file in resources.files | orderBy:\'name\'">{{file.name}}</li><li><a ngf-select=uploadResource($file)>Add new resource</a></li></ul></div><div class=container>Implemented REST APIs<ul><li ng-repeat="api in selectedAppCaps">{{api}}</li><li><a ng-click=showAPIs()>Add new API</a></li></ul></div></div></div><div class=col-sm-9><div ng-if=activeFile ui-ace="{onLoad: aceLoaded, mode: activeFile.mode}" ng-model=activeFile.content ng-model-options="{debounce: 500}" class=the-editor></div></div></div><div class=row><br><div class=col-sm-9></div><div class=col-sm-3><a role=button ng-href="/deploy?project={{project.name}}" class="btn liot-button">Go to deploy view</a></div></div></div><!--Add the footer and specify name of current page (as found in components/footer/footer.controller.js)--><liot-footer current-page=projectcode></liot-footer><script type=text/ng-template id=showapis.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><div class="liot-title">Select API template(s) to add to project {{currentProject}}</div></div><div class="modal-body"><div class="row"><div class="col-md-12"><ul ng-repeat="api in allAPIs" class="nav nav-tabs nav-stacked col-md-4 col-sm-4 top-buffer">         <li><input type="checkbox" ng-checked="implementedAPIs.indexOf(api.name) &gt; -1 || apisToAdd.indexOf(api.name) &gt; -1" |="|" ng-click="toggleAPISelection(api.name)" ng-disabled="implementedAPIs.indexOf(api.name) &gt; -1" class="pull-left"/><div class="liot-item-title">{{api.name}}</div><p>Required capabilities: {{api.devcap}} </p><p>Description: {{api.description}}</p></li></ul></div></div></div><div class="modal-footer"><button type="submit" ng-click="cancel()" class="btn liot-button">Cancel</button><button type="submit" ng-disabled="" ng-click="ok()" class="btn liot-button">Generate template(s)</button></div></script>'),a.put("app/projects/projects.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-9><div class=liot-title>Existing projects</div><div ng-init="visibleLimit = 6" class="row col-lg-12"><ul ng-repeat="project in projects | limitTo: visibleLimit as results" data-mh=projects class="list-unstyled col-md-6 col-lg-6 col-sm-6 top-buffer"><div class=liot-item><div class="liot-item-title clearfix"><i class="fa fa-file-code-o pull-left"></i><p class=pull-left>{{project.name}} : {{project.version}}</p><div role=group class="btn-group pull-right"><a ng-href=/project/{{project.name}} class="btn btn-xs btn-primary"><i class="fa fa-edit"></i></a><a ng-click=deleteProjectModal(project) class="btn btn-xs btn-primary"><i class="fa fa-trash"></i></a></div></div><!--div.clearfix--><!--p Version: {{project.version}}--><p>{{project.description}}</p></div></ul></div><button ng-hide="results.length === projects.length" ng-click="visibleLimit = visibleLimit +2" class=btn-primary>show more...</button></div><div class=col-sm-3><div class=liot-title>Create new</div><div class=row><div class=form><br><div><p>Project name:</p><input required ng-pattern="/^[a-z][a-z0-9]*$/" placeholder="" ng-model="newProj.name"></div><br><div><p>Project description:</p><textarea required placeholder="" ng-model=newProj.description></textarea></div><br><div><button type=submit ng-click=createProject() class="btn liot-button">Create</button></div></div></div></div></div></div><!--Add the footer and specify name of current page (as found in components/footer/footer.controller.js)--><liot-footer current-page=projects></liot-footer><!-- Template for the delete project modal dialog.--><!-- https://docs.angularjs.org/api/ng/directive/script--><script type=text/ng-template id=deleteproject.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Delete Project</h4></div><div class="modal-body"><form role="form" name="newprojectform" ng-submit="ok()"><div class="form-group"><label for="projectname">Enter project name to confirm deletion: <strong style="color:red;">{{project.name}}</strong></label><input type="text" required="required" ng-pattern="/^[a-z][a-z0-9]*$/" id="projectname" name="projectname" placeholder="" ng-model="projectName" class="form-control"/><span ng-if="newprojectform.projectname.$error.pattern" class="error">Project name must match <code>[a-z][a-z0-9]*</code></span><span ng-if="newprojectform.projectname.$error.required || !newprojectform.projectname.$invalid"><i class="fa"></i></span></div></form></div><div class="modal-footer"><button type="submit" ng-click="cancel()" class="btn btn-default">Cancel</button><button type="submit" ng-disabled="newprojectform.projectname.$invalid || (project.name !== projectName)" ng-click="ok()" class="btn btn-danger">Delete Project</button></div></script>'),a.put("components/footer/footer.html",'<footer class=footer><div class="container footer-font"><ul class=list-unstyled><li ng-repeat="step in steps" class=pull-left><div ng-if=step.substeps class="pull-left liot-step"><button class="btn step-stack btm"></button><button class="btn step-stack mid"></button><button ng-class="{selectedpage: step.pagename == currentPage}" class="btn step-stack top">{{step.desc}}</button></div><div ng-if=!step.substeps class="pull-left liot-step"><button ng-class="{selectedpage: step.pagename == currentPage}" class="btn step-stack top">{{step.desc}}</button></div><div ng-if=!$last class="pull-left liot-step flow"><i class="fa fa-long-arrow-right fa-3x liot-arrow"></i></div></li></ul></div><br><div class=container><small>© Tampere University of Technology 2015-2017</small></div></footer>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div ng-controller=NavbarCtrl class="navbar navbar-default navbar-static-top"><div class=container><div class=navbar-header><button type=button ng-click="isCollapsed = !isCollapsed" class=navbar-toggle><span class=sr-only>Toggle navigation</span><span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div id=navbar-main uib-collapse=isCollapsed class="navbar-collapse collapse"><ul class="nav navbar-nav"><li ng-repeat="item in menu" disabled ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}} class="btn navbar-btn">{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(&quot;/admin&quot;)}"><a href=/admin class="btn btn-primary navbar-btn">Admin</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-if=!isLoggedIn() ng-class="{active: isActive(&quot;/signup&quot;)}"><a href=/signup class="btn btn-primary navbar-btn">Sign up</a></li><li ng-if=!isLoggedIn() ng-class="{active: isActive(&quot;/login&quot;)}"><a href=/login class="btn btn-primary navbar-btn">Login</a></li><li ng-if=isLoggedIn()><p class=navbar-text>Hello {{ getCurrentUser().name }}</p></li><li ng-if=isLoggedIn() ng-class="{active: isActive(&quot;/settings&quot;)}"><a href=/settings class="btn btn-primary navbar-btn"><span class="glyphicon glyphicon-cog"></span></a></li><li ng-if=isLoggedIn() ng-class="{active: isActive(&quot;/logout&quot;)}"><a href="" ng-click=logout() class="btn btn-primary navbar-btn">Logout</a></li></ul></div></div></div>')}]);