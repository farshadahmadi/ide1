"use strict";angular.module("koodainApp",["ngCookies","ngResource","ngSanitize","ngFileUpload","ngVis","ui.router","ui.bootstrap","ui-notification","ui.ace","rt.encodeuri","nya.bootstrap.select"]).constant("deviceManagerUrl","http://resource-registry-node-mongo2.paas.msv-project.com").config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","NotificationProvider",function(a,b,c,d,e){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor"),e.setOptions({startTop:55})}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(c){d.authenticate&&!c&&(a.preventDefault(),b.path("/login"))})})}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("koodainApp").controller("LoginCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){a.errors.other=b.message})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("koodainApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("koodainApp").controller("SignupCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("koodainApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("koodainApp").controller("ApiDescrCtrl",["$scope","$http","deviceManagerUrl",function(a,b,c){function d(a,d){var e={swagger:"2.0",info:{version:"1.0.0",title:a,description:a+" API"},consumes:["application/json"],produces:["application/json"],paths:{"/items":{get:{description:"Returns all items",responses:{200:{description:"A list of items.",schema:{type:"array",items:{$ref:"#/definitions/Item"}}}}}}},definitions:{Item:{type:"object",required:["id","name"],properties:{id:{type:"integer",format:"int64"},name:{type:"string"}}}},"x-device-capability":d};return b({method:"PUT",url:c+"/apis/"+a,data:e})}function e(){b({method:"GET",url:c+"/devicecapabilities"}).then(function(b){a.devCaps=b.data})}function f(){b({method:"GET",url:c+"/apis"}).then(function(b){a.apis=b.data})}a.deviceManagerUrl=c,a.selectedDevCap="",e(),f(),a.newApi=function(){console.log(a.selectedDevCap),d(a.newApiClass,a.selectedDevCap).then(function(){f()})},a.deleteApi=function(a){b({method:"DELETE",url:c+"/apis/"+a.name}).then(function(){f()})}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("api-descr",{url:"/api-descr",templateUrl:"app/api-descr/api-descr.html",controller:"ApiDescrCtrl"})}]),angular.module("koodainApp").controller("DeployCtrl",["$scope","$http","$resource","$uibModal","Notification","VisDataSet","DeviceManager","deviceManagerUrl","$stateParams","$q",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){return b?"app:"+a.status+":selected":"app:"+a.status}function l(a,b){return b?"device:"+a.status+":selected":"device:"+a.status}function m(a){var b=a.id,c={id:b,label:a.name||b,title:J(a),x:a.coords.x,y:a.coords.y,group:l(a)};return c}function n(a){var b={id:"app:"+a.id,label:a.name,group:k(a),title:K(a)};return b}function o(a){for(var b={},c=0;c<a.length;c++){a[c].id=a[c]._id,a[c].coords={x:a[c].location.x,y:a[c].location.y};var d=a[c];b[d.id]=d}return b}function p(b,c,d,e){F.update(N.map(function(a){return{id:a,group:l(L[a])}})),F.update(b.map(function(a){return{id:a,group:l(L[a],!0)}})),F.update(Q.map(function(a){return{id:"app:"+a.id,group:k(a)}})),F.update(e.map(function(a){return{id:"app:"+a.id,group:k(a,!0)}})),N=b,O=c,P=e;var f=N.map(function(a){return L[a]});a.selectedDevices=f,a.selectedDevs4Update=d,a.camera.fit(),a.camera.checkCrawling()}function q(){console.log("updateSelection");var b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=a.appQuery,j=a.devQuery;j||i?H.queryDevicess(j,i,"or").then(function(i){i.forEach(function(a){if(d.push(a._id),a.hasOwnProperty("matchedApps")){a.matchedApps.length>0&&(f.push(a._id),e.push(a)),a.isQueried||h.push("#"+a._id),b.push.apply(b,a.matchedApps);var g=a.matchedApps.map(function(a){return"app:"+a.id});c.push.apply(c,g)}}),h.length>0&&(j?a.devQuery=j+","+h.join(","):a.devQuery=h.join(",")),g=d.concat(c),x(d),y(f),R.selectNodes(g),p(d,c,e,b)})["catch"](function(a){x(d),y(f),R.selectNodes(g),p(d,c,e,b)}):(x(d),y(f),R.selectNodes(g),p(d,c,e,b))}function r(b){a.loadDevices(),S&&clearInterval(S),S=setInterval(function(){a.loadDevices()},b)}function s(){var b=[],c=[],d=Object.keys(L).map(function(a){return m(L[a])});for(var e in L){var g=L[e],h=g.apps;h&&h.length>0&&(d.push.apply(d,h.map(n)),b.push.apply(b,h),c.push.apply(c,h.map(function(a){return{from:"app:"+a.id,to:g.id,length:50}})))}F=new f(d),G=new f(c),a.graphData={nodes:F,edges:G},Q=b}function t(a){return a&&"app:"===a.slice(0,4)}function u(a){return!t(a)}function v(b){var c=b.nodes.filter(u),d=b.nodes.filter(t);a.deselectProject();var e=null;0===b.nodes.length?(a.devQuery="",a.appQuery=""):e=b.hasOwnProperty("previousSelection")?b.event.changedPointers[0].ctrlKey?w(b.nodes,b.previousSelection.nodes):b.nodes[0]:b.nodes[b.nodes.length-1],u(e)?(b.event.changedPointers[0].ctrlKey||(a.appQuery=""),a.devQuery=c.map(function(a){return"#"+a}).join(",")):t(e)&&(b.event.changedPointers[0].ctrlKey||(a.devQuery=""),a.appQuery=d.map(function(a){return"#"+a.slice(4,a.length)}).join(",")),a.$apply()}function w(a,b){return b.filter(function(b){return-1==a.indexOf(b)})[0]}function x(a){T=a.map(function(a){return L[a].classes})}function y(a){U=a.map(function(a){return L[a].classes})}function z(a){return b({method:"GET",url:"/api/projects/"+a.name+"/files/liquidiot.json"}).then(function(b){return b.name=a.name,b})}function A(c,d,e){var f=c.url,g=d.id;return b({method:"PUT",url:"/api/projects/"+e.project+"/package",data:{deviceUrl:f,appId:g}}).then(function(b){return a.numSuccessUps++,b})["catch"](function(b){return a.numFailUps++,b})}function B(a,b){return Promise.all(a.matchedApps.map(function(c){return A(a,c,b)}))}function C(a){return Promise.all(a.selectedDevices.map(function(b){return B(b,a)}))}function D(a){return"/api/pipe/"+a}var E=c("/api/projects/:project");E.query(function(b){a.projects=b}),a.deviceManagerUrl=h;var F,G,H=g(h),I={"device:active":{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"green"},fixed:!0},"device:passive":{shape:"icon",icon:{face:"FontAwesome",code:"",size:50,color:"red"},fixed:!0},"device:active:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:70,color:"green"},fixed:!0},"device:passive:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:70,color:"red"},fixed:!0},"app:installed":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"blue"}},"app:installed:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"blue"}},"app:running":{shape:"icon",icon:{face:"FontAwesome",code:"",size:40,color:"green"}},"app:running:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"green"}},"app:crashed":{shape:"icon",icon:{face:"FontAwesome",code:"",size:40,color:"red"}},"app:crashed:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"red"}},"app:paused":{shape:"icon",icon:{face:"FontAwesome",code:"",size:40,color:"green"}},"app:paused:selected":{shape:"icon",icon:{face:"FontAwesome",code:"",size:65,color:"green"}}},J=function(a){var b="<div class='panel panel-success' style='margin-bottom:0px'><div class='panel-heading'><h3 class='panel-title'>device</h3></div><div class='panel-body' style='padding-top: 0px; padding-bottom: 0px'><table class='table' style='border: none; margin-bottom:1px'><!-- tr><td>id</td><td>"+a.id+"</td></tr><tr --><td>name</td><td>"+a.name+"</td></tr><!-- tr><td>capabilities</td><td>"+a.classes.join(", ")+"</td></tr><tr><td>location</td><td>"+a.location+"</td></tr --><tr><td>url</td><td>"+a.url+"</td></tr><!-- tr><td>coordinates</td><td>"+a.location.latitude+","+a.location.longitude+"</td></tr><tr><td>postal address</td><td>"+a.location.streetAddress+","+a.location.addressLocality+"</td></tr><tr><td>location tag</td><td>"+a.location.tag+"</td></tr --><!-- tr><td>coordination</td><td>"+a.coords.x+","+a.coords.y+"</td></tr --></table></div></div>";return b},K=function(a){var b=a.hasOwnProperty("applicationInterfaces")?a.applicationInterfaces.join(", "):"",c=a.hasOwnProperty("status")?a.status:"",d=a.hasOwnProperty("version")?a.version:"",e=a.hasOwnProperty("description")?a.description:"",f="<div class='panel panel-success' style='margin-bottom:0px'><div class='panel-heading'><h3 class='panel-title'>application</h3></div><div class='panel-body' style='padding-top: 0px; padding-bottom: 0px'><table class='table' style='border: none; margin-bottom:1px'><tr><td>id</td><td>"+a.id+"</td></tr><tr><td>name</td><td>"+a.name+"</td></tr><tr><td>interfaces</td><td>"+b+"</td></tr><tr><td>status</td><td>"+c+"</td></tr><tr><td>version</td><td>"+d+"</td></tr><tr><td>description</td><td>"+e+"</td></tr></table></div></div>";return f},L=[],M=-1;a.camera={fit:function(){R.fit()},fitOnSelectedNodes:function(){1==N.length?R.focus(N[0],{scale:1}):R.fit({nodes:N})},checkCrawling:function(){N.length>1?(M=0,a.isCrawlingPossible=!0):(M=-1,a.isCrawlingPossible=!1)},crawl:function(){M>=0&&M<=N.length&&(M==N.length&&e.info({message:"Crawling started again!",delay:1e3}),M%=N.length,R.focus(N[M],{scale:1}),M++)}},a.filterSelApp=function(b){return a.hasOwnProperty("appQuery")&&0!=a.appQuery.length&&-1==O.indexOf("app:"+b.id)?!1:!0};var N=[],O=[],P=[],Q=[];a.deviceQuery="",a.applicationQuery="",a.$watch("deviceQuery",function(b,c){a.devQuery=a.deviceQuery,a.appQuery=a.applicationQuery}),a.$watch("applicationQuery",function(b,c){a.devQuery=a.deviceQuery,a.appQuery=a.applicationQuery});var R;a.$watch("devQuery",function(a,b){R&&q()}),a.$watch("appQuery",function(a,b){R&&q()}),a.graphEvents={onload:function(a){R=a,q()},selectNode:v,deselectNode:v},a.loadDevices=function(){return H.queryDevicess().then(function(a){var b=o(a);return b}).then(function(a){return L=a,s(),"done"})};var S;r(6e4),a.graphOptions={groups:I,interaction:{multiselect:!0}};var T=[],U=[];a.deployments=[];var V=0;a.openManageDeployAppsModal=function(){d.open({controller:"ManageDeployAppsCtrl",templateUrl:"managedeployapps.html",resolve:{projects:function(){return Promise.all(a.projects.map(z))},data:function(){return{devices:a.selectedDevices,devicequery:a.devQuery,appquery:a.appQuery,selectedProject:a.selectedProject,selectedDeviceCapabilities:T}}}}).result.then(function(b){a.deployments.push(b),V+=b.numApproxDevices})},a.updates=[];var W=0;a.openManageUpdateAppsModal=function(){d.open({controller:"ManageUpdateAppsCtrl",templateUrl:"manageupdateapps.html",resolve:{projects:function(){return Promise.all(a.projects.map(z))},data:function(){return{selApps:P,devices:a.selectedDevs4Update,devicequery:a.devQuery,appquery:a.appQuery,selectedProject:a.selectedProject,selectedDeviceCapabilities:U}}}}).result.then(function(b){a.updates.push(b),W+=b.numApproxApps})},a.verifyDeployment=function(){d.open({controller:"VerifyDeploymentCtrl",templateUrl:"verifydeployment.html",resolve:{deployments:function(){return a.deployments}}}).result.then(function(){a.deploy()})},a.deploying=!1,a.deploy=function(){r(3e3);var c=angular.copy(a.deployments);a.deployments=[],c.length&&(a.numDeps=V,a.numSuccessDeps=0,a.numFailDeps=0,V=0,a.deploying=!0,e.info("Deployment process started"),b({method:"POST",url:"/api/projects/deploy",data:{deployments:c}}).then(function(b){console.log(b),a.numSuccessDeps=b.data.numberOfSuccess,a.numFailDeps=b.data.numberOfFailure,e.info("Deployment process completed"),r(6e4),a.loadDevices()})["catch"](function(b){console.log(b),e.danger("Deployment process encountered some problems!"),r(6e4),a.loadDevices()}))},a.verifyUpdate=function(){d.open({controller:"VerifyUpdateCtrl",templateUrl:"verifyupdate.html",resolve:{updates:function(){return a.updates}}}).result.then(function(){a.update()})},a.updating=!1,a.update=function(){r(3e3);var b=angular.copy(a.updates);a.updates=[],b.length&&(a.numUps=W,a.numSuccessUps=0,a.numFailUps=0,W=0,a.updating=!0,e.info("Update process started"),Promise.all(b.map(C)).then(function(b){console.log(b),e.info("Update process completed"),r(6e4),a.loadDevices()}))},a.discardDeployment=function(){a.deployments=[]},a.discardUpdate=function(){a.updates=[]},a.openLogModal=function(a,b){d.open({controller:"AppLogCtrl",templateUrl:"applog.html",resolve:{device:a,app:b}}).result.then(null,function(){clearInterval(b._logInterval)})},a.updateApp=function(c,d){return console.log(d.name),b({method:"PUT",url:"/api/projects/"+d.name.slice(10)+"/package",data:{deviceUrl:c.url,appId:d.id}}).then(function(b){a.loadDevices()})["catch"](function(b){e.error("Connection to the application was not succeccfull."),a.loadDevices()})},a.rollbackApp=function(c,d,f){var g=c.url+"/app/"+d.id+"/rollback";return b({url:D(g),method:"POST"}).then(function(b){a.loadDevices()},function(b){e.error("Connection to the application was not succeccfull."),a.loadDevices()})},a.setAppStatus=function(c,d,f){var g=c.url+"/app/"+d.id;return b({url:D(g),method:"PUT",data:{status:f}}).then(function(b){return a.loadDevices().then(function(){return b})},function(b){return"installed"!==d.status&&e.error("Starting the application was not succeccfull."),a.loadDevices().then(function(){throw b})})},a.removeApp=function(c,d){var f=c.url+"/app/"+d.id;return b({url:D(f),method:"DELETE"}).then(function(b){P.splice(P.indexOf(d),1),O.splice(O.indexOf(d.id),1),a.loadDevices()})["catch"](function(a){e.error("Connection to the application was not succeccfull.")})},a.deleting=!1,a.removeApps=function(){r(3e3),a.numDels=P.length,a.numSuccessDels=0,a.numFailDels=0,a.deleting=!0,e.info("Delete process started"),console.log(a.selectedDevs4Update);var c=a.selectedDevs4Update.map(function(a){var b=a.matchedApps.map(function(a){return{id:a.id}});return{url:a.url,matchedApps:b}});console.log(c),b({method:"DELETE",url:"/api/projects/delete",data:{devices:c},headers:{"Content-Type":"application/json;charset=utf-8"}}).then(function(b){console.log(b),a.numSuccessDels=b.data.numberOfSuccess,a.numFailDels=b.data.numberOfFailure,e.info("Delete process completed"),r(6e4),a.loadDevices()})["catch"](function(b){console.log(b),e.error("Delete process encountered some problems!"),r(6e4),a.loadDevices()})},a.deselectProject=function(){a.selectedProject=null},a.deselectProject(),a.$watch("selectedProject",function(){a.selectDevicesForProject()}),a.selectDevicesForProject=function(){a.selectedProject&&b({method:"GET",url:"/api/projects/"+a.selectedProject.name+"/files/liquidiot.json"}).then(function(b){var c=JSON.parse(b.data.content),d=c.deviceCapabilities,e=d.indexOf("free-class");-1!=e&&d.splice(e,1),d&&d.length?a.devQuery="."+d.join("."):a.devQuery="*"})},i.project&&E.get({project:i.project},function(b){a.selectedProject=b,a.selectDevicesForProject()})}]).controller("ManageDeployAppsCtrl",["$scope","$resource","$http","$uibModalInstance","data","projects",function(a,b,c,d,e,f){var g=e.selectedDeviceCapabilities;a.devices=e.devices,a.devicequery=e.devicequery,a.appquery=e.appquery;var h=function(a,b){return a.every(function(a){return b.indexOf(a)>=0})},i=function(a){return g.every(function(b){return h(a,b)})};a.projects=f.filter(function(a){var b=JSON.parse(a.data.content),c=b.deviceCapabilities,d=c.indexOf("free-class");return-1!=d&&c.splice(d,1),c&&c.length?i(c)?!0:!1:!0}),e.selectedProject&&(a.selectedProject=a.projects.filter(function(a){return a.name==e.selectedProject.name})[0]),a.cancel=function(){d.dismiss("cancel")},a.done=function(){var b={devicequery:e.devicequery,appquery:e.appquery,project:a.selectedProject.name,numApproxDevices:e.devices.length,n:a.allDevices||!a.numDevices?"all":a.numDevices,removeOld:a.removeOld,selectedDevices:e.devices};d.close(b)}}]).controller("ManageUpdateAppsCtrl",["$scope","$resource","$http","$uibModalInstance","data","projects",function(a,b,c,d,e,f){var g=e.selectedDeviceCapabilities;a.devices=e.devices,a.devicequery=e.devicequery,a.appquery=e.appquery;var h=function(a,b){return a.every(function(a){return b.indexOf(a)>=0})},i=function(a){return g.every(function(b){return h(a,b)})};a.projects=f.filter(function(a){var b=JSON.parse(a.data.content),c=b.deviceCapabilities,d=c.indexOf("free-class");return-1!=d&&c.splice(d,1),c&&c.length?i(c)?!0:!1:!0}),e.selectedProject&&(a.selectedProject=a.projects.filter(function(a){return a.name==e.selectedProject.name})[0]),a.cancel=function(){d.dismiss("cancel")},a.done=function(){var b={devicequery:e.devicequery,appquery:e.appquery,project:a.selectedProject.name,numApproxDevices:e.devices.length,numApproxApps:e.selApps.length,n:a.allDevices||!a.numDevices?"all":a.numDevices,removeOld:a.removeOld,selectedDevices:e.devices};d.close(b)}}]).controller("VerifyDeploymentCtrl",["$scope","$http","$resource","$uibModalInstance","Notification","deployments","deviceManagerUrl",function(a,b,c,d,e,f,g){a.deployments=f,a.cancel=function(){d.dismiss("cancel")},a.done=function(){d.close()},a.deploy=function(){a.done()}}]).controller("VerifyUpdateCtrl",["$scope","$http","$resource","$uibModalInstance","Notification","updates","deviceManagerUrl",function(a,b,c,d,e,f,g){a.updates=f,a.cancel=function(){d.dismiss("cancel")},a.done=function(){d.close()},a.update=function(){a.done()}}]).controller("AppLogCtrl",["$scope","$http","$uibModalInstance","Notification","device","app",function(a,b,c,d,e,f){function g(a){return"/api/pipe/"+a}a.device=e,a.app=f,a.cancel=function(){c.dismiss("cancel")},f._logInterval=setInterval(function(){var c=e.url+"/app/"+f.id+"/log";b({method:"GET",url:g(c)}).then(function(b){a.log=b.data.message},function(b){a.cancel(),d.error("Connection to the application was not successful.")})},2e3)}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("deploy",{url:"/deploy?project",templateUrl:"app/deploy/deploy.html",controller:"DeployCtrl"})}]),angular.module("koodainApp").controller("HostsCtrl",["$scope","$http",function(a,b){b({method:"GET",url:"/api/visualdevices"}).then(function(b){console.log(b.data),a.hosts=b.data})}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("hosts",{url:"/hosts",templateUrl:"app/hosts/hosts.html",controller:"HostsCtrl"})}]),angular.module("koodainApp").controller("MainCtrl",["$scope","$http","$resource","$uibModal","Notification",function(a,b,c,d,e){var f=c("/api/projects");a.projects=f.query(),a.openNewProjectModal=function(){d.open({controller:"NewProjectCtrl",templateUrl:"newproject.html"}).result.then(function(a){var b=new f({name:a});return b.$save()}).then(function(){a.projects=f.query()},function(a){e.error(a.data.error)})}}]).controller("NewProjectCtrl",["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close(a.newproject.name)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("koodainApp").controller("ProjectCtrl",["$scope","$stateParams","$resource","$http","$location","$state","Notification","Upload","project","files","resources","apitocode","deviceManagerUrl","apiParser",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){var b="module.exports = function($app, $router, $request, console){\n",c="\n}";a.content=b+a.content+c}function p(a,b){return h.upload({url:b,data:{file:a}}).then(function(){g.success("Uploaded "+a.name)})}a.project=i,a.files=j,a.resources=k,console.log(a.project),console.log(a.files),console.log(a.resources),a.changeView=function(b){f.go("deploy",{project:a.project.name})},d({method:"GET",url:m+"/devicecapabilities"}).then(function(b){a.devCaps=b.data,a.devCaps.push({name:"free-class",description:"not bound to any device"});var c=a.files.files.filter(function(a){return"liquidiot.json"===a.name});c.length>0&&(a.liquidiotJson=c[0],a.selectedDevCaps=JSON.parse(a.liquidiotJson.content).deviceCapabilities)}),a.$watch("selectedDevCaps",function(){d({method:"GET",url:m+"/apis",params:{devcap:a.selectedDevCaps}}).then(function(b){a.apis=b.data,a.selectedAppCaps=JSON.parse(a.liquidiotJson.content).applicationInterfaces})}),a.generateCode=function(){var b=JSON.parse(a.liquidiotJson.content);b.applicationInterfaces=a.selectedAppCaps,b.deviceCapabilities=a.selectedDevCaps,a.liquidiotJson.content=JSON.stringify(b);var c=a.mainFile.content,d=n.getApiList(c);console.log(d),c=n.markAsDirty(d,a.selectedAppCaps,c),a.mainFile.content=c;for(var e=d.filter(function(a){return"working"==a.state}).map(function(a){return a.name}),f=0;f<a.selectedAppCaps.length;f++)-1==e.indexOf(a.selectedAppCaps[f])&&l.generate(a.project,m+"/apis/"+a.selectedAppCaps[f]).then(function(b){a.mainFile.content+=b})},a.deleteDirtyApis=function(){var b=a.mainFile.content,c=n.getApiList(b);a.mainFile.content=n.deleteDirtyApis(c,b)},a.updating={},a.$watch("mainFile.content",function(){var b=angular.copy(a.mainFile);if(b){o(b);var c=y.update({name:b.name},b);a.updating[b.name]=c.$promise.$$state}}),a.$watch("liquidiotJson.content",function(){var b=a.liquidiotJson;if(b){var c=y.update({name:b.name},b);a.updating[b.name]=c.$promise.$$state}});var q=ace.require("ace/ext/modelist"),r="/api/projects/"+b.project;a.openFile=function(b){a.activeFile=b;var c=q.getModeForPath(b.name);a.activeFile.mode=c?c.name:null};var s=j.files.filter(function(a){return"main.js"===a.name});if(s.length>0){a.openFile(s[0]),a.mainFile=s[0];var t=esprima.parse(a.mainFile.content,{comment:!0,range:!0,loc:!0}),u=a.mainFile.content.split("\n");console.log(u);var v=t.loc.start.line,w=t.loc.end.line;console.log(t.loc.start.line+" : "+t.loc.end.line),u.splice(w-1,1),u.splice(v-1,1),console.log(u),a.mainFile.content=u.join("\n")}var x;a.aceLoaded=function(a){x=a,x.$blockScrolling=1/0,x.setOptions({fontSize:"11pt"})};var y=c(r+"/files/:name",null,{update:{method:"PUT"}});a.$watch("activeFile.content",function(){var b=a.activeFile;if("package.json"==b.name||"agent.js"==b.name){var c=y.update({name:b.name},b);a.updating[b.name]=c.$promise.$$state}}),a.uploadFile=function(b){var d=r+"/files";p(b,d).then(function(){a.files=c(d).get()})},a.uploadResource=function(b){var d=r+"/files/resources";p(b,d).then(function(){a.resources=c(d).get()})}}]).factory("apitocode",["$q",function(a){var b=function(b,d){return a(function(a,e){SwaggerParser.validate(d).then(function(d){var e="\n/**\n * Application Interface: "+d.info.title+"\n */";for(var f in d.paths)for(var g in d.paths[f])e+=c(b,g,f);a(e+"// "+d.info.title+" - end\n")})})},c=function(a,b,c){return"\n$router."+b+'("'+c+'", function(req, res){});\n'};return{generate:b}}]).factory("apiParser",function(){var a=function(a){for(var b=[],c=esprima.parse(a,{comment:!0,range:!0}),d=0;d<c.comments.length;d++){var e=c.comments[d];if("Block"==e.type&&e.value.includes("Application Interface")){var f="",g="";if(5==e.value.indexOf("Application Interface")){var h=e.value.substring(28),i=h.indexOf("\n");f=h.substring(0,i)}else{var h=e.value.substring(29),i=h.indexOf("\n");f=h.substring(0,i-1)}g=e.value.includes("dirty")?"dirty":"working",b.push({name:f,range:[e.range[0],e.range[1]],state:g})}else"Line"==e.type&&b.length>0&&e.value.includes(b[b.length-1].name)&&(b[b.length-1].range.push(e.range[0]),b[b.length-1].range.push(e.range[1]))}return b},b=function(a,b,c){for(var d=a.length-1;d>=0;d--)"working"==a[d].state&&-1==b.indexOf(a[d].name)&&(console.log(d),c=c.slice(0,a[d].range[1]-2)+"* dirty\n "+c.slice(a[d].range[1]-2,a[d].range[1])+"\n/*"+c.slice(a[d].range[1],a[d].range[2])+"*/\n"+c.slice(a[d].range[2]));return c},c=function(a,b){for(var c=a.length-1;c>=0;c--)"dirty"==a[c].state&&(b=b.slice(0,a[c].range[0]-1)+b.slice(a[c].range[3]+1));return b};return{getApiList:a,markAsDirty:b,deleteDirtyApis:c}}),angular.module("koodainApp").config(["$stateProvider",function(a){a.state("project",{url:"/project/:project",templateUrl:"app/project/project.html",controller:"ProjectCtrl",resolve:{project:["$stateParams","$resource",function(a,b){return b("/api/projects/"+a.project).get().$promise}],files:["$stateParams","$resource",function(a,b){return b("/api/projects/"+a.project+"/files").get().$promise}],resources:["$stateParams","$resource",function(a,b){return b("/api/projects/"+a.project+"/files/resources").get().$promise}]}})}]),angular.module("koodainApp").service("DeviceManager",["$http","$resource","$q","deviceManagerUrl",function(a,b,c,d){function e(a,b){return b.id==a}function f(a,b){return b.type==a}function g(a,b){if(!a)return!0;for(var c=0;c<a.length;c++)if(!b.classes||-1===b.classes.indexOf(a[c]))return!1;return!0}function h(a,b){return"not"===a.key?!q(b,a.value):!0}function i(a,b){if(!a)return!0;for(var c=0;c<a.length;c++)if(!h(a[c],b))return!1;return!0}function j(a,b){return a.tag&&"*"!==a.tag&&!f(a.tag,b)?!1:g(a.classList,b)?a.id&&!e(a.id,b)?!1:i(a.pseudos,b)?a.attributes&&!k(a.attributes,b)?!1:!0:!1:!1}function k(a,b){for(var c=0;c<a.length;c++)if(!l(a[c],b))return!1;return!0}function l(a,b){return a.test(b[a.key])}function m(a,b){for(var c=0;c<a.length;c++)if(!j(a[c],b))return!1;return!0}function n(a,b){for(var c=b.expressions,d=0;d<c.length;d++)if(m(c[d],a))return!0;return!1}function o(a,b,c){if("string"==typeof b&&(b=Slick.parse(b)),!b)return[];var d=a.apps;if(!d)return!1;for(var e=!1,f=0;f<d.length;f++)n(d[f],b)&&(c||-1!=v.devices.indexOf(a.id)||v.devices.push(a.id),v.apps.push(d[f].id),e=!0);return e}function p(a,b){if("string"==typeof b&&(b=Slick.parse(b)),!b)return[];for(var c=b.expressions,d=0;d<c.length;d++)if(m(c[d],a))return v.devices.push(a.id),!0;return!1}function q(a,b,c){return b&&!p(a,b)?!1:c&&!o(a,c,b)?!1:!0}function r(a,b,c){if(v={devices:[],apps:[]},!b&&!c)return v;for(var d in a)q(a[d],b,c);return v}function s(){return c(function(b,c){a({method:"GET",url:"/api/visualdevices"}).then(function(a){for(var c=a.data,d={},e=0;e<c.length;e++){c[e].coords={x:e%10*200,y:200*Math.floor(e/10)};var f=c[e];d[f.id]=f}b(d)})})}function t(a){return s().then(function(b){for(var c in b)a[c]=b[c];return a})}function u(b,c,e){return a({method:"GET",url:d,params:{device:b,app:c,operation:e}}).then(function(a){return a.data})}var v={};return function(a){function b(a,b){return c.devices(a,b)}var c=devicelib(a);return{queryDevicess:u,queryDevices:b,filter:r,addMockDevicesTo:t}}}]),angular.module("koodainApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop;return d.save(a,function(b){return e.put("token",b.token),g=d.get(),c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},getToken:function(){return e.get("token")}}}]),angular.module("koodainApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("koodainApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("koodainApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("koodainApp").controller("NavbarCtrl",["$scope","$location","$state","Auth",function(a,b,c,d){a.$state=c,a.menu=[{title:"Edit",link:"/project"},{title:"Deploy",link:"/deploy"},{title:"APIs",link:"/api-descr"},{title:"Hosts",link:"/hosts"}],a.isCollapsed=!0,a.isLoggedIn=d.isLoggedIn,a.isAdmin=d.isAdmin,a.getCurrentUser=d.getCurrentUser,a.logout=function(){d.logout(),b.path("/login")},a.isActive=function(a){return(b.path()+"/").startsWith(a+"/")}}]),angular.module("koodainApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Login</h1><p>Accounts are reset on server restart from<code>server/config/seed.js</code>. Default account is<code>test@test.com</code>/<code>test</code></p><p>Admin account is<code>admin@admin.com</code>/<code>admin</code></p></div><div class=col-sm-12><form name=form ng-submit=login(form) novalidate class=form><div class=form-group><label>Email</label><input name=email ng-model=user.email class="form-control"></div><div class=form-group><label>Password</label><input type=password name=password ng-model=user.password class="form-control"></div><div class="form-group has-error"><p ng-show="form.email.$error.required &amp;&amp; form.password.$error.required &amp;&amp; submitted" class=help-block>Please enter your email and password.</p><p class=help-block>{{ errors.other }}</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-login">Login</button> <a href=/signup class="btn btn-default btn-lg btn-register">Register</a></div><hr><div><a href="" ng-click=loginOauth(&quot;facebook&quot;) class="btn btn-facebook"><i class="fa fa-facebook"></i> Connect with Facebook</a> <a href="" ng-click=loginOauth(&quot;google&quot;) class="btn btn-google-plus"><i class="fa fa-google-plus"></i> Connect with Google+</a> <a href="" ng-click=loginOauth(&quot;twitter&quot;) class="btn btn-twitter"><i class="fa fa-twitter"></i> Connect with Twitter</a></div></form></div></div><hr></div>'),
a.put("app/account/settings/settings.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form name=form ng-submit=changePassword(form) novalidate class=form><div class=form-group><label>Current Password</label><input type=password name=password ng-model=user.oldPassword mongoose-error="" class="form-control"><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword ng-model=user.newPassword ng-minlength=3 required class="form-control"><p ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) &amp;&amp; (form.newPassword.$dirty || submitted)" class=help-block>Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button type=submit class="btn btn-lg btn-primary">Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Sign up</h1></div><div class=col-sm-12><form name=form ng-submit=register(form) novalidate class=form><div ng-class="{ &quot;has-success&quot;: form.name.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.name.$invalid &amp;&amp; submitted }" class=form-group><label>Name</label><input name=name ng-model=user.name required class="form-control"><p ng-show="form.name.$error.required &amp;&amp; submitted" class=help-block>A name is required</p></div><div ng-class="{ &quot;has-success&quot;: form.email.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.email.$invalid &amp;&amp; submitted }" class=form-group><label>Email</label><input type=email name=email ng-model=user.email required mongoose-error="" class="form-control"><p ng-show="form.email.$error.email &amp;&amp; submitted" class=help-block>Doesn\'t look like a valid email.</p><p ng-show="form.email.$error.required &amp;&amp; submitted" class=help-block>What\'s your email address?</p><p ng-show=form.email.$error.mongoose class=help-block>{{ errors.email }}</p></div><div ng-class="{ &quot;has-success&quot;: form.password.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.password.$invalid &amp;&amp; submitted }" class=form-group><label>Password</label><input type=password name=password ng-model=user.password ng-minlength=3 required mongoose-error="" class="form-control"><p ng-show="(form.password.$error.minlength || form.password.$error.required) &amp;&amp; submitted" class=help-block>Password must be at least 3 characters.</p><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.password }}</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-login">Sign up</button> <a href=/login class="btn btn-default btn-lg btn-register">Login</a></div><hr><div><a href="" ng-click=loginOauth(&quot;facebook&quot;) class="btn btn-facebook"><i class="fa fa-facebook"></i> Connect with Facebook</a> <a href="" ng-click=loginOauth(&quot;google&quot;) class="btn btn-google-plus"><i class="fa fa-google-plus"></i> Connect with Google+</a> <a href="" ng-click=loginOauth(&quot;twitter&quot;) class="btn btn-twitter"><i class="fa fa-twitter"></i> Connect with Twitter</a></div></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li ng-repeat="user in users" class=list-group-item><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span><a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/api-descr/api-descr.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h2>APIs</h2><ul class=list-group><li ng-repeat="api in apis" class=list-group-item><h4>{{api.name}}</h4><div role=group class=btn-group><a href="{{deviceManagerUrl+\'/apis/\'+api.name}}" target=_blank class="btn btn-default"><i class="fa fa-eye"></i></a><a href="/swagger-editor/#/?backend={{deviceManagerUrl+\'/apis/\'+api.name | encodeUri}}" target=_blank class="btn btn-info"><i class="fa fa-edit"></i></a><button ng-click=deleteApi(api) class="btn btn-danger"><i class="fa fa-trash"></i></button></div></li></ul></div></div><form name=newapiform ng-submit=newApi() class=form-inline><div class=form-group><label for=apiClass>New Application Interface:</label><input required id=apiClass name=apiClass ng-model=newApiClass placeholder="Class name" class="form-control"><label for=apiSelect>Device Capability:</label><select ng-model=selectedDevCap id=apiSelect class=form-control><option ng-repeat="devCap in devCaps">{{devCap.name}}</option></select><input type=submit value=Create ng-disabled=!newApiClass class="form-control"></div></form></div><div ng-include=&quot;components/footer/footer.html&quot;></div>'),a.put("app/deploy/deploy.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div id=r class=container><div ng-if=deployments.length style="text-align:center; padding:24px" class=jumbotron>You have staged deployment changes<br><button ng-click=discardDeployment() class="btn btn-default">Discard</button> <button ng-click=verifyDeployment() class="btn btn-primary">Verify</button></div><div ng-if=updates.length style="text-align:center; padding:24px" class=jumbotron>You have staged updates changes<br><button ng-click=discardUpdate() class="btn btn-default">Discard</button> <button ng-click=verifyUpdate() class="btn btn-primary">Verify</button></div><div class=row><div class=col-sm-4><p>{{selectedDevices.length}} devices selected</p><p><button ng-disabled=!selectedDevices.length ng-click=openManageDeployAppsModal() class="btn btn-default">Deploy Apps</button><button ng-disabled=!selectedDevs4Update.length ng-click=openManageUpdateAppsModal() class="btn btn-default navbar-right">Update Apps</button></p><p><div ng-if=deploying><p>Last deployment progress status:</p><uib-progress max=numDeps><uib-bar value=numSuccessDeps type=success><span ng-hide="numSuccessDeps==0">{{numSuccessDeps}}</span></uib-bar><uib-bar value=numFailDeps type=danger><span ng-hide="numFailDeps==0">{{numFailDeps}}</span></uib-bar></uib-progress></div><div ng-if=updating><p>Last update progress status:</p><uib-progress max=numUps><uib-bar value=numSuccessUps type=success><span ng-hide="numSuccessUps==0">{{numSuccessUps}}</span></uib-bar><uib-bar value=numFailUps type=danger><span ng-hide="numFailUps==0">{{numFailUps}}</span></uib-bar></uib-progress></div><div ng-if=deleting><p>Last delete progress status:</p><uib-progress max=numDels><uib-bar value=numSuccessDels type=success><span ng-hide="numSuccessDels==0">{{numSuccessDels}}</span></uib-bar><uib-bar value=numFailDels type=danger><span ng-hide="numFailDels==0">{{numFailDels}}</span></uib-bar></uib-progress></div></p><p><button ng-if="selectedDevs4Update.length &gt; 0" ng-click=removeApps() class="btn btn-danger"><i class="fa fa-trash">Delete all apps</i></button></p><p><ul ng-init="shownIndex = -1" class=list-group><li ng-repeat="device in selectedDevices" ng-click="$parent.shownIndex = $index" class=list-group-item><i class=fa>{{device.code}}</i> <strong>{{device.id}}</strong><div><ul class=appinfo><li ng-repeat="app in device.apps | filter:filterSelApp"><strong>{{app.name}} {{app.version}}</strong> {{app.status}} <a ng-href={{deviceManagerUrl}}/devices/{{device.id}}/apps/{{app.id}}/api target=_blank>API</a><br><div ng-if="app.status !==\'installed\'" role=group class=btn-group><a ng-if="app.name.indexOf(\'liquidiot-\')===0" ng-href=/project/{{app.name.slice(10)}} class="btn btn-default"><i class="fa fa-edit"></i></a><button ng-click="openLogModal(device, app)" class="btn btn-default"><i class="fa fa-list"></i></button><button ng-if="app.status===\'paused\'" ng-click="setAppStatus(device, app, \'running\')" class="btn btn-primary"><i class="fa fa-play"></i></button><button ng-if="app.status===\'running\'" ng-click="setAppStatus(device, app, \'paused\')" class="btn btn-primary"><i class="fa fa-pause"></i></button><button ng-if=app.canRollback ng-click="rollbackApp(device, app)" class="btn btn-warning"><i class="fa fa-rotate-left"></i></button><button ng-click="updateApp(device, app)" class="btn btn-success"><i class="fa fa-rotate-right"></i></button><button ng-click="removeApp(device, app)" class="btn btn-danger"><i class="fa fa-trash"></i></button></div><i ng-if="app.status ===\'installed\'" style="color: red" class="fa fa-spinner fa-pulse fa-2x fa-fw"></i><span ng-if="app.status ===\'installed\'" style="color: red">Trying to run the application</span></li></ul></div><div><small><code ng-repeat="cls in device.classes">{{cls}}</code></small></div></li></ul></p></div><div class=col-sm-8><p>Select a proejct to find compatible target devices<ul ng-model=selectedProject title="select a project" data-live-search=true class=nya-bs-select><li nya-bs-option="project in projects"><a>{{project.name}}<span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></p><p>Or query devices:<!--form.form-inline.queryform--><form><div class=form-group><label for=devicequery>Device:</label><input id=devicequery ng-model=deviceQuery ng-model-options="{debounce: 200}" ng-change=deselectProject() class="form-control"></div><div class=form-group><label for=appquery>App:</label><input id=appquery ng-model=applicationQuery ng-model-options="{debounce: 200}" ng-change=deselectProject() class="form-control"></div></form></p><div id=network><vis-network data=graphData options=graphOptions events=graphEvents component=network></vis-network></div><p><div role=group class=btn-group><button ng-click=loadDevices() class="btn btn-default"><span class="fa fa-refresh"></span></button><button ng-click=camera.fit() class="btn btn-default"><span class="fa fa-arrows-alt">fit camera</span></button><button ng-click=camera.fitOnSelectedNodes() class="btn btn-default"><span class="fa fa-arrows-alt">fit camera on selection</span></button><button ng-click=camera.crawl() ng-show=isCrawlingPossible class="btn btn-default"><span class="fa fa-arrows-alt">crawl in selection</span></button></div></p></div></div></div><div ng-include=&quot;components/footer/footer.html&quot;></div><!-- App management (deployment) modal dialog--><script type=text/ng-template id=managedeployapps.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Deploy Applications</h4></div><div class="modal-body"><form name="form" class="form"><div class="form-group"><label for="selectproject">Deploy application</label> <ul ng-model="selectedProject" title="select a project" data-live-search="true" class="nya-bs-select"><li nya-bs-option="project in projects"><a>{{project.name}}<span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul><!--select.form-control(id="selectproject", ng-model="selectedProject")// option(ng-repeat="project in projects") {{project.name}}--> <label><span ng-if="devicequery">to all the devices matching the query<code> {{devicequery}}</code></span><span ng-if="!devicequery">to all the devices</span><span ng-if="appquery"> with an app matching<code>{{appquery}}</code></span>. </label><small> (Approx. {{devices.length}} such devices.)</small></div></form><div class="modal-footer"><button ng-disabled="!selectedProject" ng-click="done()" class="btn btn-default">Stage deployment</button></div></div></script><!-- App management (deployment) modal dialog--><script type=text/ng-template id=manageupdateapps.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Update Applications</h4></div><div class="modal-body"><form name="form" class="form"><div class="form-group"><label for="selectproject">Update application</label> <ul ng-model="selectedProject" title="select a project" data-live-search="true" class="nya-bs-select"><li nya-bs-option="project in projects"><a>{{project.name}}<span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul><!--select.form-control(id="selectproject", ng-model="selectedProject")// option(ng-repeat="project in projects") {{project.name}}--> <label><!--span(ng-if="devicequery") to all the devices matching the query//code  {{devicequery}}--><!--span(ng-if="!devicequery") to all the devices--><span ng-if="appquery"> to all apps with an app matching<code>{{appquery}}</code></span>. </label><small> (Approx. {{devices.length}} such devices.)</small></div></form><div class="modal-footer"><button ng-disabled="!selectedProject" ng-click="done()" class="btn btn-default">Stage update</button></div></div></script><!-- Verify deployment modal dialog--><script type=text/ng-template id=verifydeployment.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Deploy</h4></div><div class="modal-body"><ul class="list-group"><li ng-repeat="deployment in deployments" class="list-group-item">Deploy the latest version of <strong>{{deployment.project}}</strong> to\n <span ng-if="deployment.n===\'all\'">all the </span><span ng-if="deployment.n!==\'all\'">{{deployment.n}}</span> devices matching <strong><code>{{deployment.devicequery}}</code> - <code>{{deployment.appquery}}</code></strong> (approx. {{deployment.numApproxDevices}} such devices)<ul><li ng-if="deployment.removeOld">Remove earlier versions of the app</li></ul></li></ul></div><div class="modal-footer"><p><button class="btn btn-default"><i class="fa fa-save"></i> \nSave for later</button><button ng-click="deploy()" class="btn btn-primary"><i class="fa fa-paper-plane"></i> \nDeploy</button></p></div></script><!-- Verify deployment modal dialog--><script type=text/ng-template id=verifyupdate.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Update</h4></div><div class="modal-body"><ul class="list-group"><li ng-repeat="update in updates" class="list-group-item">Update the latest version of <strong>{{update.project}}</strong> to all the apps matching<strong><code>{{update.appquery}}</code></strong><ul><li ng-if="update.removeOld">Remove earlier versions of the app</li></ul></li></ul></div><div class="modal-footer"><p><button class="btn btn-default"><i class="fa fa-save"></i> \nSave for later</button><button ng-click="update()" class="btn btn-primary"><i class="fa fa-paper-plane"></i> \nUpdate</button></p></div></script><!-- Application log modal dialog--><script type=text/ng-template id=applog.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">Log of {{app.id}} at {{device.id}}</h4></div><div class="modal-body"><pre>{{log}}</pre></div></script>'),a.put("app/hosts/hosts.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h2>Hosts</h2><table class="table table-bordered table-hover"><thead><th>name</th><th>status</th></thead><tr ng-repeat="host in hosts"><td>{{host.name}}</td><td>{{host.status}}</td></tr></table></div></div></div><div ng-include=&quot;components/footer/footer.html&quot;></div>'),a.put("app/main/main.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h3>Projects</h3><p>Choose a project or create a new one</p><ul ng-repeat="project in projects" class="nav nav-tabs nav-stacked col-md-3 col-lg-3 col-sm-4"><li class=project><a ng-href=/project/{{project.name}}>{{project.name}}</a></li></ul></div><div class=col-sm-12><button ng-click=openNewProjectModal() class="btn btn-primary mainbutton"><i class="fa fa-plus"></i> New Project</button></div></div></div><div ng-include=&quot;components/footer/footer.html&quot;></div><!-- Template for the create new project modal dialog.--><!-- https://docs.angularjs.org/api/ng/directive/script--><script type=text/ng-template id=newproject.html><div class="modal-header"><button type="button" ng-click="cancel()" class="close">&times;</button><h4 class="modal-title">New Project</h4></div><div class="modal-body"><form role="form" name="newprojectform" ng-submit="ok()"><div class="form-group"><label for="projectname">Project name:</label><input type="text" required="required" ng-pattern="/^[a-z][a-z0-9]*$/" id="projectname" name="projectname" placeholder="" ng-model="newproject.name" class="form-control"/><span ng-if="newprojectform.projectname.$error.pattern" class="error">Project name must match <code>[a-z][a-z0-9]*</code></span><span ng-if="newprojectform.projectname.$error.required || !newprojectform.projectname.$invalid"><i class="fa"></i></span></div></form></div><div class="modal-footer"><button type="submit" ng-click="cancel()" class="btn btn-default">Cancel</button><button type="submit" ng-disabled="newprojectform.projectname.$invalid" ng-click="ok()" class="btn btn-primary">Create project</button></div></script>'),a.put("app/project/project.html",'<!-- Copyright (c) TUT Tampere University of Technology 2015-2016--><!-- All rights reserved.--><!-- --><!-- Main author(s):--><!-- Antti Nieminen <antti.h.nieminen@tut.fi>--><div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-3><div class=sidebar><!--h4 {{project.name}} source files--><h2>{{project.name}}</h2><a ng-href="/">Change project</a><div class=files><ul class=list-group><li ng-repeat="file in files.files | filter:{isDirectory: false} | orderBy:\'name\'" ng-class="{active: activeFile.name===file.name}" ng-click=openFile(file) class="list-group-item project-file">{{file.name}} <i ng-if="updating[file.name].status===0" class="fa fa-circle-o-notch fa-spin"></i><i ng-if="updating[file.name].status===2" class="fa fa-warning"></i></li><li class=list-group-item><div ngf-select=uploadFile($file) class="btn btn-default"><i class="fa fa-plus"></i> Upload</div></li></ul><h4>{{project.name}} resources</h4><ul class=list-group><li ng-repeat="file in resources.files | orderBy:\'name\'" class=list-group-item>{{file.name}}</li><li class=list-group-item><div ngf-select=uploadResource($file) class="btn btn-default"><i class="fa fa-plus"></i> Upload</div></li></ul><div class=form><div class=form-group><h4>Device Capabilities</h4><ul ng-model=selectedDevCaps title="All Capabilities" data-live-search=true multiple class=nya-bs-select><li nya-bs-option="devCap in devCaps" data-value=devCap.name><a>{{devCap.name}}<span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></div><div class=form-group><h4>Application Interfaces</h4><ul ng-model=selectedAppCaps data-live-search=true multiple class=nya-bs-select><li nya-bs-option="api in apis group by api.devcap" data-value=api.name><span class=dropdown-header>{{$group}}</span><a>{{api.name}}<span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></div><div role=group class=btn-group-vertical><button ng-click=generateCode() class="btn btn-default"><i class="fa fa-code"></i> Generate API Code</button><button ng-click=deleteDirtyApis() class="btn btn-default"><i class="fa fa-times"></i> Delete dirty APIs</button></div><div class=form-group><a role=button ng-href="/deploy?project={{project.name}}" class="btn btn-default">Go to deploy view</a></div></div><!--div.btn.btn-default(ng-click="changeView(\'deploy\')") Do to deploy view--><!--.divbutton.btn.btn-default--></div></div></div><div class=col-sm-9><div ng-if=activeFile ui-ace="{onLoad: aceLoaded, mode: activeFile.mode}" ng-model=activeFile.content ng-model-options="{debounce: 500}" class=the-editor></div></div></div></div><div ng-include=&quot;components/footer/footer.html&quot;></div>'),a.put("components/footer/footer.html","<footer class=footer><div class=container><small>© Tampere University of Technology 2015-2016</small></div></footer>"),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div ng-controller=NavbarCtrl class="navbar navbar-default navbar-static-top"><div class=container><div class=navbar-header><button type=button ng-click="isCollapsed = !isCollapsed" class=navbar-toggle><span class=sr-only>Toggle navigation</span><span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button><a href="/" class=navbar-brand>SIOTAD PROJECT</a></div><div id=navbar-main uib-collapse=isCollapsed class="navbar-collapse collapse"><ul class="nav navbar-nav"><li ng-repeat="item in menu" disabled ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(&quot;/admin&quot;)}"><a href=/admin>Admin</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-if=!isLoggedIn() ng-class="{active: isActive(&quot;/signup&quot;)}"><a href=/signup>Sign up</a></li><li ng-if=!isLoggedIn() ng-class="{active: isActive(&quot;/login&quot;)}"><a href=/login>Login</a></li><li ng-if=isLoggedIn()><p class=navbar-text>Hello {{ getCurrentUser().name }}</p></li><li ng-if=isLoggedIn() ng-class="{active: isActive(&quot;/settings&quot;)}"><a href=/settings><span class="glyphicon glyphicon-cog"></span></a></li><li ng-if=isLoggedIn() ng-class="{active: isActive(&quot;/logout&quot;)}"><a href="" ng-click=logout()>Logout</a></li></ul></div></div></div>')}]);